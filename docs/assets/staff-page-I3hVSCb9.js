import{r as o,g as Y,j as e,z as Z,A as _}from"./index-CJ2DIymG.js";import{A as L,a as z,b as I}from"./avatar-Dze5cSwP.js";import{B as u}from"./badge-CLI1tUaz.js";import{B as t}from"./button-Kaq_t9cK.js";import{C as ee,b as se,c as ae,d as ie,a as ne}from"./card-B9vxntf8.js";import{D as F,b as k,c as A,d as P,e as E,f as M}from"./dialog-DoccAKgl.js";import{u as te,s as re,F as le,a as j,b as p,c as g,d as v,e as K,f as ce,z as r}from"./zod-CRx0QJTL.js";import{I as O}from"./input-BfJTMYPp.js";import{S as oe}from"./switch-rAzT_CYb.js";import{T as de,a as he,b as N,c as l,d as me,e as n}from"./table-BHW7RANY.js";import{T as xe,a as ue,b as $,c as q}from"./tabs-CqV2n-kQ.js";import{u as je,T as pe}from"./textarea-B-V9iR8_.js";import{u as B}from"./useQuery-qRia3138.js";import{U as ge,C as ve}from"./user-plus-C32LaaHi.js";import{S as Ne}from"./search-D7g6xJ2A.js";import{L as H}from"./loader-circle-VElHJp7b.js";import{M as be,P as fe}from"./phone-Dr2ncyKT.js";import{S as ye}from"./scissors-CdRMOk0I.js";import{C as Ce}from"./calendar-B1YcSnLZ.js";import"./Combination-B68zxYJI.js";import"./index-BVEw5k79.js";import"./index-CINiAiVv.js";import"./index-BuMtFZ2j.js";const Te=r.object({userId:r.number(),specialization:r.string().min(2,{message:"Phải có ít nhất 2 ký tự"}),bio:r.string().optional(),available:r.boolean().default(!0)});function Je(){const[c,Q]=o.useState(""),[a,b]=o.useState(null),[U,f]=o.useState(!1),[V,d]=o.useState(!1),{toast:y}=Y(),{data:R=[],isLoading:G}=B({queryKey:["/api/staff"]}),{data:C=[],isLoading:J}=B({queryKey:["/api/staff",a==null?void 0:a.id,"appointments"],enabled:!!a}),h=je({mutationFn:async s=>(await Z("PUT",`/api/staff/${s.id}`,s.staff)).json(),onSuccess:()=>{_.invalidateQueries({queryKey:["/api/staff"]}),d(!1),y({title:"Thành công",description:"Thông tin nhân viên đã được cập nhật"})},onError:s=>{y({title:"Lỗi",description:`Không thể cập nhật thông tin: ${s.message}`,variant:"destructive"})}}),m=R.filter(s=>{var S,D;return`${s.user.firstName} ${s.user.lastName}`.toLowerCase().includes(c.toLowerCase())||(((S=s.user.email)==null?void 0:S.toLowerCase())||"").includes(c.toLowerCase())||(((D=s.specialization)==null?void 0:D.toLowerCase())||"").includes(c.toLowerCase())}),W=s=>{b(s),f(!0)},T=s=>{b(s),i.reset({userId:s.userId,specialization:s.specialization||"",bio:s.bio||"",available:s.available??!0}),d(!0)},w=(s,x)=>`${s.charAt(0)}${x.charAt(0)}`.toUpperCase(),i=te({resolver:re(Te),defaultValues:{userId:0,specialization:"",bio:"",available:!0}}),X=s=>{a&&h.mutate({id:a.id,staff:{specialization:s.specialization,bio:s.bio,available:s.available}})};return e.jsxs("div",{children:[e.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"font-heading text-2xl font-bold text-neutral-900",children:"Nhân viên"}),e.jsx("p",{className:"text-neutral-600",children:"Quản lý tất cả nhân viên của salon"})]}),e.jsxs(t,{children:[e.jsx(ge,{className:"mr-2 h-4 w-4"}),"Thêm nhân viên"]})]}),e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"relative",children:[e.jsx(Ne,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 transform text-gray-400"}),e.jsx(O,{placeholder:"Tìm kiếm theo tên, chuyên môn...",className:"pl-9",value:c,onChange:s=>Q(s.target.value)})]})}),e.jsxs(ee,{children:[e.jsxs(se,{className:"pb-3",children:[e.jsx(ae,{children:"Danh sách nhân viên"}),e.jsxs(ie,{children:["Tổng cộng: ",m.length," nhân viên"]})]}),e.jsx(ne,{children:G?e.jsx("div",{className:"flex h-64 items-center justify-center",children:e.jsx(H,{className:"h-8 w-8 animate-spin text-primary"})}):e.jsx("div",{className:"rounded-md border",children:e.jsxs(de,{children:[e.jsx(he,{children:e.jsxs(N,{children:[e.jsx(l,{children:"Nhân viên"}),e.jsx(l,{children:"Chuyên môn"}),e.jsx(l,{children:"Email"}),e.jsx(l,{children:"Tình trạng"}),e.jsx(l,{className:"text-right",children:"Thao tác"})]})}),e.jsx(me,{children:m.length>0?m.map(s=>e.jsxs(N,{children:[e.jsx(n,{children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs(L,{children:[e.jsx(z,{src:s.user.profileImage||void 0}),e.jsx(I,{children:w(s.user.firstName,s.user.lastName)})]}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium",children:[s.user.firstName," ",s.user.lastName]}),e.jsx("p",{className:"text-sm text-gray-500",children:s.user.phone||""})]})]})}),e.jsx(n,{children:s.specialization||"Chưa cung cấp"}),e.jsx(n,{children:s.user.email}),e.jsx(n,{children:e.jsx(u,{variant:s.available?"default":"secondary",children:s.available?"Đang làm việc":"Nghỉ phép"})}),e.jsxs(n,{className:"text-right",children:[e.jsx(t,{variant:"ghost",size:"sm",onClick:()=>W(s),children:"Chi tiết"}),e.jsx(t,{variant:"ghost",size:"sm",onClick:()=>T(s),children:"Sửa"})]})]},s.id)):e.jsx(N,{children:e.jsx(n,{colSpan:5,className:"py-8 text-center text-gray-500",children:"Không tìm thấy nhân viên nào"})})})]})})})]}),a&&e.jsx(F,{open:U,onOpenChange:f,children:e.jsxs(k,{className:"sm:max-w-[600px]",children:[e.jsxs(A,{children:[e.jsx(P,{children:"Thông tin nhân viên"}),e.jsx(E,{children:"Chi tiết thông tin và lịch làm việc"})]}),e.jsxs("div",{className:"mb-4 flex flex-col items-start gap-4 md:flex-row md:items-center",children:[e.jsxs(L,{className:"h-16 w-16",children:[e.jsx(z,{src:a.user.profileImage||void 0}),e.jsx(I,{className:"text-xl",children:w(a.user.firstName,a.user.lastName)})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-xl font-bold",children:[a.user.firstName," ",a.user.lastName]}),e.jsx(u,{variant:a.available?"default":"secondary",className:"mt-1",children:a.available?"Đang làm việc":"Nghỉ phép"}),e.jsxs("div",{className:"mt-2 flex flex-col space-y-1",children:[e.jsxs("div",{className:"flex items-center text-sm text-gray-500",children:[e.jsx(be,{className:"mr-2 h-4 w-4"}),a.user.email]}),a.user.phone&&e.jsxs("div",{className:"flex items-center text-sm text-gray-500",children:[e.jsx(fe,{className:"mr-2 h-4 w-4"}),a.user.phone]}),a.specialization&&e.jsxs("div",{className:"flex items-center text-sm text-gray-500",children:[e.jsx(ye,{className:"mr-2 h-4 w-4"}),a.specialization]})]})]})]}),a.bio&&e.jsx("div",{className:"my-2 rounded-md bg-gray-50 p-3",children:e.jsx("p",{className:"text-sm",children:a.bio})}),e.jsxs(xe,{defaultValue:"schedule",children:[e.jsxs(ue,{className:"grid w-full grid-cols-2",children:[e.jsx($,{value:"schedule",children:"Lịch làm việc"}),e.jsx($,{value:"appointments",children:"Lịch hẹn"})]}),e.jsx(q,{value:"schedule",className:"py-2",children:e.jsx("div",{className:"rounded-md bg-gray-50 p-4 text-center",children:e.jsx("p",{className:"text-gray-500",children:"Tính năng lịch làm việc sẽ được cập nhật sau"})})}),e.jsx(q,{value:"appointments",className:"py-2",children:J?e.jsx("div",{className:"flex h-48 items-center justify-center",children:e.jsx(H,{className:"h-6 w-6 animate-spin text-primary"})}):C.length>0?e.jsx("div",{className:"space-y-3",children:C.map(s=>e.jsxs("div",{className:"flex items-center justify-between rounded-md border p-3",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(Ce,{className:"mr-2 h-4 w-4 text-primary"}),e.jsx("span",{className:"font-medium",children:new Date(s.date).toLocaleDateString("vi-VN")}),e.jsxs("span",{className:"ml-1 text-sm text-gray-500",children:["(",new Date(s.date).toLocaleTimeString("vi-VN",{hour:"2-digit",minute:"2-digit"}),")"]})]}),e.jsxs("div",{className:"mt-1 text-sm text-gray-500",children:["Khách hàng: ",s.userId,e.jsx("br",{}),"Dịch vụ: ",s.serviceId]})]}),e.jsx(u,{variant:s.status==="completed"?"default":s.status==="confirmed"?"secondary":s.status==="cancelled"?"destructive":"outline",children:s.status==="completed"?"Hoàn thành":s.status==="confirmed"?"Đã xác nhận":s.status==="cancelled"?"Đã hủy":"Chưa xác nhận"})]},s.id))}):e.jsxs("div",{className:"py-8 text-center text-gray-500",children:[e.jsx(ve,{className:"mx-auto mb-2 h-10 w-10 text-gray-300"}),e.jsx("p",{children:"Nhân viên chưa có lịch hẹn nào"})]})})]}),e.jsx(M,{children:e.jsx(t,{variant:"outline",onClick:()=>T(a),children:"Chỉnh sửa thông tin"})})]})}),a&&e.jsx(F,{open:V,onOpenChange:d,children:e.jsxs(k,{className:"sm:max-w-[500px]",children:[e.jsxs(A,{children:[e.jsx(P,{children:"Chỉnh sửa thông tin nhân viên"}),e.jsx(E,{children:"Cập nhật thông tin chuyên môn và trạng thái làm việc"})]}),e.jsx(le,{...i,children:e.jsxs("form",{onSubmit:i.handleSubmit(X),className:"space-y-4",children:[e.jsx(j,{control:i.control,name:"specialization",render:({field:s})=>e.jsxs(p,{children:[e.jsx(g,{children:"Chuyên môn"}),e.jsx(v,{children:e.jsx(O,{placeholder:"Ví dụ: Cắt tóc, Nhuộm, Uốn xoăn...",...s})}),e.jsx(K,{})]})}),e.jsx(j,{control:i.control,name:"bio",render:({field:s})=>e.jsxs(p,{children:[e.jsx(g,{children:"Tiểu sử / Giới thiệu"}),e.jsx(v,{children:e.jsx(pe,{placeholder:"Mô tả ngắn về kinh nghiệm và chuyên môn...",className:"resize-none",...s})}),e.jsx(K,{})]})}),e.jsx(j,{control:i.control,name:"available",render:({field:s})=>e.jsxs(p,{className:"flex flex-row items-center justify-between rounded-lg border p-4",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(g,{className:"text-base",children:"Trạng thái làm việc"}),e.jsx(ce,{children:"Nhân viên có thể nhận lịch hẹn khi đang hoạt động"})]}),e.jsx(v,{children:e.jsx(oe,{checked:s.value,onCheckedChange:s.onChange})})]})}),e.jsx(M,{children:e.jsx(t,{type:"submit",disabled:h.isPending,children:h.isPending?"Đang xử lý...":"Lưu thay đổi"})})]})})]})})]})}export{Je as default};
