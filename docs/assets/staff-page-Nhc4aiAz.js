import{n as se,j as e,o as A,z as P,E as h,h as ne,G as ae,F as ie,H as re,r as V}from"./index-Co3jKZaL.js";import{c as te,d as le,u as ce,g as oe}from"./staff-BQ08NgdR.js";import{u as L}from"./useMutation-BSFioODP.js";import{g as M}from"./salon-DTDDsyB3.js";import{D as O,b as z,c as B,d as U,e as H,f as he}from"./dialog-DsEfTekn.js";import{z as p,u as de,s as me,F as xe,a as g,b as v,c as f,d as N,e as S,f as ue}from"./zod-DR_j3zP9.js";import{u as K}from"./useQuery-D61Jsyd7.js";import{B as I}from"./button-BNCUvJzd.js";import{I as pe}from"./image-upload-BUG-tjVl.js";import{I as k}from"./input-DAU5vPOq.js";import{S as D,a as _,b as q,c as F,d as b}from"./select-CMLZ4ZLM.js";import{S as je}from"./switch-CzByGCby.js";import{T as ge}from"./textarea-DI5-A45c.js";import{A as Q,a as R,b as $}from"./avatar-Tfx6-8Q8.js";import{B as w}from"./badge-DtNea2y1.js";import{M as ve,P as fe}from"./phone-3q90w9pn.js";import{B as Ne}from"./building-BqEZWs2q.js";import{S as ye}from"./search-CISIHeZP.js";import{C as Se,b as Ce,c as Te,d as be,a as ke}from"./card-5fN4BC23.js";import{T as Ie,a as Ve,b as E,c as C,d as we,e as y}from"./table-dVrvrjgP.js";import{P as Ee}from"./pencil-D5-fFQMG.js";import{T as De}from"./trash-2-Cbbl3EUH.js";import{D as _e}from"./data-pagination-BpWcArmC.js";import{u as qe,a as Fe}from"./use-sync-url-states-W091DZhx.js";import{U as Ae}from"./user-plus-gfJGLHqz.js";import"./Combination-Bb8ckWgm.js";import"./label-BQaUV1Av.js";import"./index-DswitM9L.js";import"./loader-circle-DuW_hbzs.js";import"./index-C7ei8kKs.js";import"./index-m_3Aq4-g.js";import"./index-BV-DTqk3.js";import"./chevron-left-DiLf67sb.js";import"./chevron-right-BVZHUiVw.js";import"./isNumber-5m_zYJtK.js";/**
 * @license lucide-react v0.488.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pe=[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]],Le=se("database",Pe);var u=(r=>(r[r.INACTIVE=0]="INACTIVE",r[r.ACTIVE=1]="ACTIVE",r))(u||{});const Ke=p.object({salonId:p.number({required_error:"Vui lòng chọn salon",invalid_type_error:"Salon không hợp lệ"}).nullable(),avatar:p.string({required_error:"Vui lòng nhập link ảnh đại diện",invalid_type_error:"Ảnh đại diện không hợp lệ"}),description:p.string({required_error:"Vui lòng nhập mô tả",invalid_type_error:"Mô tả không hợp lệ"}).max(500,"Mô tả không được vượt quá 500 ký tự"),skill:p.string({required_error:"Vui lòng nhập kỹ năng",invalid_type_error:"Kỹ năng không hợp lệ"}).max(200,"Kỹ năng không được vượt quá 200 ký tự"),email:p.string({required_error:"Vui lòng nhập email",invalid_type_error:"Email không hợp lệ"}).email("Email không hợp lệ"),phone:p.string({required_error:"Vui lòng nhập số điện thoại",invalid_type_error:"Số điện thoại không hợp lệ"}).min(10,"Số điện thoại phải có ít nhất 10 chữ số"),name:p.string({required_error:"Vui lòng nhập tên nhân viên",invalid_type_error:"Tên không hợp lệ"}).min(1,"Tên không được để trống").max(100,"Tên không được vượt quá 100 ký tự"),status:p.nativeEnum(u,{required_error:"Vui lòng chọn trạng thái",invalid_type_error:"Trạng thái không hợp lệ"})});function G({isOpen:r,isSubmitting:s,title:c,description:n,defaultValues:d,onClose:o,onSubmit:m}){const{data:{data:T=[]}={}}=K({queryKey:["/api/salons"],queryFn:M}),l=de({resolver:me(Ke),defaultValues:{salonId:null,avatar:"",description:"",skill:"",email:"",phone:"",name:"",status:u.ACTIVE,...d}}),t=a=>{m(a)};return e.jsx(O,{open:r,onOpenChange:o,children:e.jsxs(z,{className:"h-[calc(100vh-200px)] px-0 sm:max-w-[550px]",children:[e.jsxs(B,{className:"px-6",children:[e.jsx(U,{children:c}),e.jsx(H,{children:n})]}),e.jsx(xe,{...l,children:e.jsxs("form",{onSubmit:l.handleSubmit(t),className:"space-y-4 overflow-y-auto p-6 pb-12",children:[e.jsx(g,{control:l.control,name:"salonId",render:({field:a})=>{var j;return e.jsxs(v,{children:[e.jsx(f,{children:"Salon"}),e.jsxs(D,{onValueChange:x=>a.onChange(parseInt(x)),value:(j=a.value)==null?void 0:j.toString(),children:[e.jsx(N,{children:e.jsx(_,{children:e.jsx(q,{placeholder:"Chọn salon"})})}),e.jsx(F,{children:T.map(x=>e.jsx(b,{value:x.id.toString(),children:x.name},x.id))})]}),e.jsx(S,{})]})}}),e.jsx(g,{control:l.control,name:"name",render:({field:a})=>e.jsxs(v,{children:[e.jsx(f,{children:"Tên nhân viên"}),e.jsx(N,{children:e.jsx(k,{placeholder:"Nhập tên nhân viên",...a})}),e.jsx(S,{})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(g,{control:l.control,name:"email",render:({field:a})=>e.jsxs(v,{children:[e.jsx(f,{children:"Email"}),e.jsx(N,{children:e.jsx(k,{type:"email",placeholder:"Nhập email",...a})}),e.jsx(S,{})]})}),e.jsx(g,{control:l.control,name:"phone",render:({field:a})=>e.jsxs(v,{children:[e.jsx(f,{children:"Số điện thoại"}),e.jsx(N,{children:e.jsx(k,{placeholder:"Nhập số điện thoại",...a})}),e.jsx(S,{})]})})]}),e.jsx(g,{control:l.control,name:"skill",render:({field:a})=>e.jsxs(v,{children:[e.jsx(f,{children:"Kỹ năng chính"}),e.jsx(N,{children:e.jsx(k,{placeholder:"Ví dụ: Cắt tóc, Nhuộm, Uốn xoăn...",...a})}),e.jsx(S,{})]})}),e.jsx(g,{control:l.control,name:"description",render:({field:a})=>e.jsxs(v,{children:[e.jsx(f,{children:"Mô tả"}),e.jsx(N,{children:e.jsx(ge,{placeholder:"Mô tả về nhân viên...",className:"resize-none",...a})}),e.jsx(S,{})]})}),e.jsx(g,{control:l.control,name:"avatar",render:({field:a})=>e.jsxs(v,{children:[e.jsx(f,{children:"Ảnh đại diện"}),e.jsx(N,{children:e.jsx(pe,{value:a.value?[{imagePath:a.value}]:[],onChange:j=>{var x;return a.onChange(((x=j[0])==null?void 0:x.imagePath)??"")},maxFiles:1,variant:"avatar",aspectRatio:"square",showCounter:!1,showFileName:!1,className:"w-[200px]"})}),e.jsx(S,{})]})}),e.jsx(g,{control:l.control,name:"status",render:({field:a})=>e.jsxs(v,{className:"flex flex-row items-center justify-between rounded-lg border p-4",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(f,{className:"text-base",children:"Trạng thái hoạt động"}),e.jsx(ue,{children:"Nhân viên có thể nhận lịch hẹn khi đang hoạt động"})]}),e.jsx(N,{children:e.jsx(je,{checked:a.value===u.ACTIVE,onCheckedChange:j=>a.onChange(j?u.ACTIVE:u.INACTIVE)})})]})}),e.jsx(he,{className:"absolute inset-x-6 bottom-6",children:e.jsx(I,{type:"submit",disabled:s,children:s?"Đang xử lý...":"Lưu"})})]})})]})})}function Me({isOpen:r,onClose:s}){const{toast:c}=A(),n=L({mutationFn:te,onSuccess:()=>{P.invalidateQueries({queryKey:["/api/staff"]}),s(),c({title:"Thành công",description:"Nhân viên đã được tạo."})},onError:o=>{c({title:"Lỗi",description:`Không thể tạo nhân viên: ${o.message}`,variant:"destructive"})}}),d=o=>{n.mutate(o)};return e.jsx(G,{isOpen:r,onClose:s,onSubmit:d,isSubmitting:n.isPending,title:"Thêm nhân viên mới",description:"Nhập thông tin để tạo tài khoản nhân viên mới"})}function Oe({isOpen:r,data:s,onClose:c}){return e.jsx(O,{open:r,onOpenChange:c,children:e.jsxs(z,{className:"sm:max-w-[600px]",children:[e.jsxs(B,{children:[e.jsx(U,{children:"Thông tin nhân viên"}),e.jsx(H,{children:"Chi tiết thông tin và lịch làm việc"})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-start space-x-4",children:[e.jsxs(Q,{className:"h-20 w-20",children:[e.jsx(R,{src:s.avatar||void 0}),e.jsx($,{className:"text-lg",children:s.user.name})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("h3",{className:"text-lg font-semibold",children:s.user.name}),e.jsxs("div",{className:"flex items-center text-sm text-gray-500",children:[e.jsx(ve,{className:"mr-1 h-4 w-4"}),s.user.email]}),s.user.phone&&e.jsxs("div",{className:"flex items-center text-sm text-gray-500",children:[e.jsx(fe,{className:"mr-1 h-4 w-4"}),s.user.phone]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"mb-2 font-medium",children:"Thông tin Salon"}),e.jsxs("div",{className:"flex items-center space-x-2 rounded-lg border p-3",children:[e.jsx(Ne,{className:"h-5 w-5 text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.salon.name}),e.jsx("p",{className:"text-sm text-gray-500",children:s.salon.address})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"mb-2 font-medium",children:"Chuyên môn"}),e.jsx("p",{className:"text-sm text-gray-600",children:s.skill||"Chưa cung cấp"})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"mb-2 font-medium",children:"Tiểu sử"}),e.jsx("p",{className:"text-sm text-gray-600",children:s.description||"Chưa cung cấp"})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"mb-2 font-medium",children:"Vai trò"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:s.user.roles.map(n=>e.jsx(w,{variant:"outline",children:n.name},n.id))})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"mb-2 font-medium",children:"Trạng thái"}),e.jsx(w,{variant:s.user.status?"default":"secondary",children:s.user.status?"Đang làm việc":"Nghỉ phép"})]})]})]})]})})}function ze({filters:r,setFilters:s}){const{data:{data:c=[]}={}}=K({queryKey:["/api/services/salons"],queryFn:M});return e.jsxs("div",{className:"mb-6 flex gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(ye,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 transform text-gray-400"}),e.jsx(k,{placeholder:"Tìm kiếm theo tên, chuyên môn...",className:"pl-9",value:r.search,onChange:n=>s.search(n.target.value)})]}),e.jsxs(D,{value:r.salonId||h,onValueChange:n=>s.salonId(n===h?"":n),children:[e.jsx(_,{className:"w-full md:w-[200px]",children:e.jsx(q,{placeholder:"Lọc theo Salon"})}),e.jsxs(F,{children:[e.jsx(b,{value:h,children:"Tất cả Salon"}),c.map(n=>e.jsx(b,{value:String(n.id),children:n.name},n.id))]})]}),e.jsxs(D,{value:r.status||h,onValueChange:n=>s.status(n===h?"":n),children:[e.jsx(_,{className:"w-full md:w-[200px]",children:e.jsx(q,{placeholder:"Trạng thái"})}),e.jsxs(F,{children:[e.jsx(b,{value:h,children:"Tất cả trạng thái"}),e.jsx(b,{value:String(u.ACTIVE),children:"Đang hoạt động"}),e.jsx(b,{value:String(u.INACTIVE),children:"Tạm ngưng"})]})]})]})}function Be({data:r,total:s,isLoading:c,onEdit:n,openStaffDetails:d}){const{toast:o}=A(),m=ne(),T=L({mutationFn:le,onSuccess:()=>{P.invalidateQueries({queryKey:["/api/staff"]}),o({title:"Thành công",description:"Chương trình khuyến mãi đã được xóa."})},onError:t=>{o({title:"Lỗi",description:`Không thể xóa chương trình khuyến mãi: ${t.message}`,variant:"destructive"})},onSettled:()=>{m(ie())}}),l=t=>{m(re()),T.mutate(t)};return e.jsxs(Se,{children:[e.jsxs(Ce,{className:"pb-3",children:[e.jsx(Te,{children:"Danh sách nhân viên"}),e.jsxs(be,{children:["Tổng cộng: ",s," nhân viên"]})]}),e.jsx(ke,{children:e.jsx("div",{className:"rounded-md border",children:c?e.jsx(ae,{}):e.jsxs(Ie,{children:[e.jsx(Ve,{children:e.jsxs(E,{children:[e.jsx(C,{children:"Nhân viên"}),e.jsx(C,{children:"Salon"}),e.jsx(C,{children:"Chuyên môn"}),e.jsx(C,{children:"Vai trò"}),e.jsx(C,{children:"Email"}),e.jsx(C,{children:"Tình trạng"}),e.jsx(C,{className:"text-right",children:"Thao tác"})]})}),e.jsx(we,{children:r.length>0?r.map(t=>e.jsxs(E,{children:[e.jsx(y,{children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs(Q,{children:[e.jsx(R,{src:t.avatar||void 0}),e.jsx($,{children:t.user.name})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:t.user.name}),e.jsx("p",{className:"text-sm text-gray-500",children:t.user.phone||""})]})]})}),e.jsx(y,{children:t.salon.name}),e.jsx(y,{children:t.skill||"Chưa cung cấp"}),e.jsx(y,{children:e.jsx("div",{className:"flex flex-wrap gap-1",children:t.user.roles.map(a=>e.jsx(w,{variant:"outline",children:a.name},a.id))})}),e.jsx(y,{children:t.user.email}),e.jsx(y,{children:e.jsx(w,{variant:t.user.status===u.ACTIVE?"default":"secondary",children:t.user.status===u.ACTIVE?"Đang làm việc":"Nghỉ phép"})}),e.jsxs(y,{className:"flex justify-end gap-1",children:[e.jsxs(I,{variant:"outline",size:"sm",onClick:()=>d(t),children:[e.jsx(Le,{className:"mr-1 h-4 w-4"}),"Chi tiết"]}),e.jsxs(I,{variant:"outline",size:"sm",onClick:()=>n(t),children:[e.jsx(Ee,{className:"mr-1 h-4 w-4"}),"Sửa"]}),e.jsxs(I,{variant:"destructive",size:"sm",onClick:()=>{confirm("Bạn có chắc chắn muốn xóa nhân viên này?")&&l(t.id)},children:[e.jsx(De,{className:"mr-1 h-4 w-4"}),"Xóa"]})]})]},t.id)):e.jsx(E,{children:e.jsx(y,{colSpan:7,className:"py-8 text-center text-gray-500",children:"Không tìm thấy nhân viên nào"})})})]})})})]})}function Ue({isOpen:r,staff:s,onClose:c}){const{toast:n}=A(),d=L({mutationFn:ce,onSuccess:()=>{P.invalidateQueries({queryKey:["/api/staff"]}),c(),n({title:"Thành công",description:"Thông tin nhân viên đã được chỉnh sửa."})},onError:m=>{n({title:"Lỗi",description:`Không thể chỉnh sửa được thông tin nhân viên: ${m.message}`,variant:"destructive"})}}),o=m=>{d.mutate({id:s.id,data:m})};return e.jsx(G,{defaultValues:{salonId:s.salonId,avatar:s.avatar,description:s.description,skill:s.skill,email:s.user.email,phone:s.user.phone,name:s.user.name,status:s.user.status},isOpen:r,isSubmitting:d.isPending,title:"Sửa thông tin nhân viên",description:"Nhập thông tin để sửa thông tin nhân viên",onClose:c,onSubmit:o})}function bs(){const[r,s]=V.useState(null),[c,n]=V.useState(!1),[d,o]=V.useState(!1),[m,T]=V.useState(!1),{values:l,setters:t}=qe({search:{defaultValue:"",parse:i=>i,stringify:i=>i},salonId:{defaultValue:h,parse:i=>i,stringify:i=>i?String(i):h},status:{defaultValue:h,parse:i=>i,stringify:i=>i?String(i):h},page:{defaultValue:1,parse:i=>Number(i)||1,stringify:i=>String(i)},size:{defaultValue:8,parse:i=>Number(i)||8,stringify:i=>String(i)}}),a=Fe({search:l.search,salonId:l.salonId===h?"":l.salonId,status:l.status===h?"":l.status,page:l.page-1,size:l.size}),{data:{data:j=[],total:x,totalPage:X=1,currentPage:J=1}={},isLoading:W}=K({queryKey:["/api/staff",a],queryFn:()=>oe(a)}),Y=i=>{s(i),n(!0)},Z=i=>{s(i),o(!0)},ee=i=>{t.page(i)};return e.jsx(e.Fragment,{children:e.jsxs("div",{children:[e.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"font-heading text-2xl font-bold text-neutral-900",children:"Nhân viên"}),e.jsx("p",{className:"text-neutral-600",children:"Quản lý tất cả nhân viên của salon"})]}),e.jsxs(I,{onClick:()=>T(!0),children:[e.jsx(Ae,{className:"mr-2 h-4 w-4"}),"Thêm nhân viên"]})]}),e.jsx(ze,{filters:l,setFilters:t}),e.jsx(Be,{data:j,total:x,isLoading:W,onEdit:Z,openStaffDetails:Y}),e.jsx(_e,{currentPage:J,totalPage:X,onPageChange:ee}),r&&e.jsx(Oe,{isOpen:c,data:r,onClose:()=>n(!1)}),d&&r&&e.jsx(Ue,{isOpen:d,staff:r,onClose:()=>o(!1)}),m&&e.jsx(Me,{isOpen:m,onClose:()=>T(!1)})]})})}export{bs as default};
