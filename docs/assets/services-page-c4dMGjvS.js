import{n as A,B as _,j as e,o as K,r as P,X as R,z,E as d,h as J,G as Y,F as Z,H as V}from"./index-Co3jKZaL.js";import{z as h,u as ee,s as ne,F as se,a as g,b as p,c as j,d as u,e as v}from"./zod-DR_j3zP9.js";import{B as M}from"./badge-DtNea2y1.js";import{B as f}from"./button-BNCUvJzd.js";import{C as te,b as re,c as ae,d as W,a as ie,e as ce}from"./card-5fN4BC23.js";import{T as oe}from"./trash-2-Cbbl3EUH.js";import{u as $}from"./useMutation-BSFioODP.js";import{g as B}from"./salon-DTDDsyB3.js";import{D as le,b as he,c as de,d as me,e as xe,f as ge}from"./dialog-DsEfTekn.js";import{I as C}from"./input-DAU5vPOq.js";import{S as k,a as w,b as q,c as D,d as y}from"./select-CMLZ4ZLM.js";import{T as pe}from"./textarea-DI5-A45c.js";import{u as F}from"./useQuery-D61Jsyd7.js";import{I as je}from"./image-upload-BUG-tjVl.js";import{S as ue}from"./search-CISIHeZP.js";import{D as ve}from"./data-pagination-BpWcArmC.js";import{u as ye,a as Ne}from"./use-sync-url-states-W091DZhx.js";import{P as Se}from"./plus-CAZAkEn4.js";import"./label-BQaUV1Av.js";import"./Combination-Bb8ckWgm.js";import"./index-C7ei8kKs.js";import"./index-m_3Aq4-g.js";import"./index-BV-DTqk3.js";import"./index-DswitM9L.js";import"./loader-circle-DuW_hbzs.js";import"./chevron-left-DiLf67sb.js";import"./chevron-right-BVZHUiVw.js";import"./isNumber-5m_zYJtK.js";/**
 * @license lucide-react v0.488.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const be=[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]],Ce=A("square-pen",be),Te=async n=>(await _.get("/admin/service",{params:n})).data.result,Ie=async n=>(await _.post("/admin/service",n)).data.result,fe=async({id:n,data:c})=>(await _.put(`/admin/service/${n}`,c)).data.result,ke=async n=>{await _.delete(`/admin/service/${n}`)};var T=(n=>(n[n.HIDDEN=0]="HIDDEN",n[n.SHOW=1]="SHOW",n))(T||{});const we=h.object({categoryId:h.number({required_error:"Vui lòng chọn danh mục",invalid_type_error:"Danh mục không hợp lệ"}),salonId:h.number({required_error:"Vui lòng chọn salon",invalid_type_error:"Salon không hợp lệ"}),name:h.string({required_error:"Vui lòng nhập tên dịch vụ"}).min(1,"Tên dịch vụ không được để trống").max(100,"Tên dịch vụ không được vượt quá 100 ký tự"),subtitle:h.string().max(200,"Phụ đề không được vượt quá 200 ký tự").optional(),versionName:h.string().max(50,"Tên phiên bản không được vượt quá 50 ký tự").optional(),description:h.string().max(500,"Mô tả không được vượt quá 500 ký tự").optional(),basePrice:h.number({required_error:"Vui lòng nhập giá gốc",invalid_type_error:"Giá gốc không hợp lệ"}).min(1,"Giá gốc lớn hơn không"),discountPrice:h.number({invalid_type_error:"Giá khuyến mãi không hợp lệ"}).min(0,"Giá khuyến mãi không được âm").optional(),duration:h.number({required_error:"Vui lòng nhập thời gian"}).min(1,"Thời gian phải lớn hơn 0").max(480,"Thời gian không được vượt quá 480 phút"),tags:h.array(h.string()).min(1,"Vui lòng thêm ít nhất một Tag").max(10,"Không được thêm quá 10 tags"),order:h.number().min(0,"Thứ tự không được âm").default(0),status:h.nativeEnum(T,{invalid_type_error:"Trạng thái không hợp lệ",required_error:"Vui lòng chọn trạng thái"}),images:h.array(h.object({id:h.number().optional(),name:h.string(),imagePath:h.string()}),{required_error:"Vui lòng thêm ít nhất một hình ảnh"})}).refine(n=>!n.discountPrice||n.discountPrice<n.basePrice,{message:"Giá khuyến mãi phải nhỏ hơn giá gốc",path:["discountPrice"]});function qe({service:n,setEditingService:c,handleDeleteService:s}){return e.jsxs(te,{className:"overflow-hidden",children:[n.images&&n.images.length>0&&e.jsxs("div",{className:"relative h-32 w-full overflow-hidden",children:[e.jsx("img",{src:n.images[0].imagePath,alt:n.name,className:"h-full w-full object-cover"}),n.images.length>1&&e.jsxs("div",{className:"absolute bottom-2 right-2 rounded-full bg-black/50 px-2 py-1 text-xs text-white",children:["+",n.images.length-1," ảnh"]})]}),e.jsxs(re,{className:"space-y-1 p-3",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx(ae,{className:"line-clamp-1 text-base",children:n.name}),n.subtitle&&e.jsx(W,{className:"line-clamp-1 text-xs",children:n.subtitle})]}),e.jsx(M,{variant:n.status===T.SHOW?"default":"secondary",className:"shrink-0 text-xs",children:n.status===T.SHOW?"Đang hoạt động":"Tạm ngưng"})]}),e.jsx(W,{className:"line-clamp-2 text-xs",children:n.description||"Không có mô tả"})]}),e.jsxs(ie,{className:"flex-1 space-y-2 p-3 pt-0",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Thời gian:"}),e.jsxs("span",{className:"ml-1 font-medium",children:[n.duration," phút"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Giá:"}),e.jsxs("span",{className:"ml-1 font-medium text-primary",children:[n.basePrice.toLocaleString("vi-VN"),"₫"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Danh mục:"}),e.jsx("span",{className:"ml-1 line-clamp-1 font-medium",children:n.category.name})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Salon:"}),e.jsx("span",{className:"ml-1 line-clamp-1 font-medium",children:n.salon.name})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Lượt sử dụng:"}),e.jsx("span",{className:"ml-1 font-medium",children:n.used})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Thứ tự:"}),e.jsxs("span",{className:"ml-1 font-medium",children:["#",n.order]})]})]}),n.tags&&n.tags.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1",children:n.tags.map((x,a)=>e.jsx(M,{variant:"outline",className:"text-xs",children:x},a))})]}),e.jsxs(ce,{className:"flex justify-end gap-2 border-t p-3",children:[e.jsxs(f,{variant:"outline",size:"sm",onClick:()=>c(n),children:[e.jsx(Ce,{className:"mr-1 h-3 w-3"}),"Sửa"]}),e.jsxs(f,{variant:"destructive",size:"sm",onClick:()=>s(n.id),children:[e.jsx(oe,{className:"mr-1 h-3 w-3"}),"Xóa"]})]})]})}const Q=async()=>(await _.get("/admin/category")).data.result;function U({isLoading:n,isEdit:c,values:s,onSubmit:x,isOpen:a,onClose:N,title:m,description:S}){const{toast:b}=K(),{data:{data:L=[]}={}}=F({queryKey:["/api/services/categories"],queryFn:Q}),{data:{data:O=[]}={}}=F({queryKey:["/api/services/salons"],queryFn:B}),o=ee({resolver:ne(we),defaultValues:{categoryId:s==null?void 0:s.categoryId,salonId:s==null?void 0:s.salonId,name:(s==null?void 0:s.name)??"",subtitle:(s==null?void 0:s.subtitle)??"",versionName:(s==null?void 0:s.versionName)??"",description:(s==null?void 0:s.description)??"",basePrice:+((s==null?void 0:s.basePrice)||0),discountPrice:+((s==null?void 0:s.discountPrice)||0),duration:s==null?void 0:s.duration,tags:(s==null?void 0:s.tags)??[],status:s==null?void 0:s.status,images:(s==null?void 0:s.images)??[]}}),[I,E]=P.useState(""),H=()=>{if(I.trim()){const t=o.getValues("tags")||[];t.length<10&&!t.includes(I.trim())&&(o.setValue("tags",[...t,I.trim()]),E(""))}},G=t=>{const l=o.getValues("tags")||[];o.setValue("tags",l.filter(i=>i!==t))},r=async t=>{try{await x(t)}catch{b({title:"Lỗi",description:"Có lỗi xảy ra khi lưu dịch vụ",variant:"destructive"})}};return e.jsx(le,{open:a,onOpenChange:N,children:e.jsxs(he,{className:"h-[calc(100vh-200px)] px-0 sm:max-w-[550px]",children:[e.jsxs(de,{className:"mx-6",children:[e.jsx(me,{children:m}),e.jsx(xe,{children:S})]}),e.jsx(se,{...o,children:e.jsxs("form",{onSubmit:o.handleSubmit(r),className:"space-y-4 overflow-y-auto p-6 pt-3",children:[e.jsx(g,{control:o.control,name:"categoryId",render:({field:t})=>{var l;return e.jsxs(p,{children:[e.jsx(j,{children:"Danh mục"}),e.jsxs(k,{onValueChange:i=>t.onChange(parseInt(i)),value:(l=t.value)==null?void 0:l.toString(),children:[e.jsx(u,{children:e.jsx(w,{children:e.jsx(q,{placeholder:"Chọn danh mục"})})}),e.jsx(D,{children:L.map(i=>e.jsx(y,{value:`${i.id}`,children:i.name},i.id))})]}),e.jsx(v,{})]})}}),e.jsx(g,{control:o.control,name:"salonId",render:({field:t})=>{var l;return e.jsxs(p,{children:[e.jsx(j,{children:"Salon"}),e.jsxs(k,{onValueChange:i=>t.onChange(parseInt(i)),value:(l=t.value)==null?void 0:l.toString(),children:[e.jsx(u,{children:e.jsx(w,{children:e.jsx(q,{placeholder:"Chọn salon"})})}),e.jsx(D,{children:O.map(i=>e.jsx(y,{value:i.id.toString(),children:i.name},i.name))})]}),e.jsx(v,{})]})}}),e.jsx(g,{control:o.control,name:"name",render:({field:t})=>e.jsxs(p,{children:[e.jsx(j,{children:"Tên dịch vụ"}),e.jsx(u,{children:e.jsx(C,{placeholder:"Nhập tên dịch vụ",...t})}),e.jsx(v,{})]})}),e.jsx(g,{control:o.control,name:"subtitle",render:({field:t})=>e.jsxs(p,{children:[e.jsx(j,{children:"Phụ đề"}),e.jsx(u,{children:e.jsx(C,{placeholder:"Nhập phụ đề",...t})}),e.jsx(v,{})]})}),e.jsx(g,{control:o.control,name:"versionName",render:({field:t})=>e.jsxs(p,{children:[e.jsx(j,{children:"Tên phiên bản"}),e.jsx(u,{children:e.jsx(C,{placeholder:"Nhập tên phiên bản",...t})}),e.jsx(v,{})]})}),e.jsx(g,{control:o.control,name:"tags",render:({field:t})=>{var l;return e.jsxs(p,{children:[e.jsx(j,{children:"Tags"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(u,{children:e.jsx(C,{placeholder:"Nhập tag và nhấn Enter",value:I,onChange:i=>E(i.target.value),onKeyDown:i=>{i.key==="Enter"&&(i.preventDefault(),H())}})}),e.jsx(f,{type:"button",variant:"outline",onClick:H,children:"Thêm"})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:(l=t.value)==null?void 0:l.map((i,X)=>e.jsxs(M,{variant:"secondary",children:[i,e.jsx("button",{type:"button",className:"ml-1 hover:text-destructive",onClick:()=>G(i),children:e.jsx(R,{className:"h-3 w-3"})})]},X))}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Tối đa 10 tags. Nhấn Enter hoặc nút Thêm để thêm tag mới."})]}),e.jsx(v,{})]})}}),e.jsx(g,{control:o.control,name:"description",render:({field:t})=>e.jsxs(p,{children:[e.jsx(j,{children:"Mô tả"}),e.jsx(u,{children:e.jsx(pe,{placeholder:"Nhập mô tả",...t})}),e.jsx(v,{})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(g,{control:o.control,name:"basePrice",render:({field:t})=>e.jsxs(p,{children:[e.jsx(j,{children:"Giá gốc"}),e.jsx(u,{children:e.jsx(C,{type:"number",min:"0",...t,onChange:l=>t.onChange(parseInt(l.target.value))})}),e.jsx(v,{})]})}),e.jsx(g,{control:o.control,name:"discountPrice",render:({field:t})=>e.jsxs(p,{children:[e.jsx(j,{children:"Giá khuyến mãi"}),e.jsx(u,{children:e.jsx(C,{type:"number",min:"0",...t,onChange:l=>t.onChange(parseInt(l.target.value))})}),e.jsx(v,{})]})})]}),e.jsx(g,{control:o.control,name:"duration",render:({field:t})=>e.jsxs(p,{children:[e.jsx(j,{children:"Thời gian (phút)"}),e.jsx(u,{children:e.jsx(C,{type:"number",min:1,step:20,...t,onChange:l=>t.onChange(parseInt(l.target.value))})}),e.jsx(v,{})]})}),e.jsx(g,{control:o.control,name:"status",render:({field:t})=>{var l;return e.jsxs(p,{children:[e.jsx(j,{children:"Trạng thái"}),e.jsxs(k,{onValueChange:i=>t.onChange(parseInt(i)),value:(l=t.value)==null?void 0:l.toString(),children:[e.jsx(u,{children:e.jsx(w,{children:e.jsx(q,{placeholder:"Chọn trạng thái"})})}),e.jsxs(D,{children:[e.jsx(y,{value:`${T.SHOW}`,children:"Hiển thị"}),e.jsx(y,{value:`${T.HIDDEN}`,children:"Ẩn"})]})]}),e.jsx(v,{})]})}}),e.jsx(g,{control:o.control,name:"images",render:({field:t})=>e.jsxs(p,{children:[e.jsx(j,{children:"Hình ảnh"}),e.jsx(u,{children:e.jsx(je,{value:t.value,onChange:t.onChange,maxFiles:5})}),e.jsx(v,{})]})}),e.jsxs(ge,{className:"absolute inset-x-6 bottom-6",children:[e.jsx(f,{type:"button",variant:"outline",onClick:N,children:"Hủy"}),e.jsx(f,{type:"submit",disabled:n,children:n?"Đang xử lý...":c?"Cập nhật":"Thêm dịch vụ"})]})]})})]})})}function De({isOpen:n,onClose:c}){const{toast:s}=K(),[x,a]=P.useState(!1),N=$({mutationFn:Ie,onSuccess:()=>{z.invalidateQueries({queryKey:["/api/services"]}),c(),s({title:"Thành công",description:"Dịch vụ đã được tạo."})},onError:S=>{s({title:"Lỗi",description:`Không thể tạo dịch vụ: ${S.message}`,variant:"destructive"})},onSettled:()=>{a(!1)}}),m=S=>{a(!0),N.mutate(S)};return e.jsx(U,{isEdit:!1,isLoading:x,isOpen:n,title:"Thêm dịch vụ",description:"Thêm dịch vụ mới vào hệ thống",onSubmit:m,onClose:c})}function Pe({filters:n,setFilters:c}){const{data:{data:s=[]}={}}=F({queryKey:["/api/services/categories"],queryFn:Q}),{data:{data:x=[]}={}}=F({queryKey:["/api/services/salons"],queryFn:B});return e.jsxs("div",{className:"mb-6 flex flex-col gap-4 md:flex-row",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(ue,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 transform text-gray-400"}),e.jsx(C,{placeholder:"Tìm kiếm dịch vụ...",className:"pl-9",value:n.name,onChange:a=>c.name(a.target.value)})]}),e.jsxs(k,{value:n.salonId||d,onValueChange:a=>c.salonId(a===d?"":a),children:[e.jsx(w,{className:"w-full md:w-[200px]",children:e.jsx(q,{placeholder:"Lọc theo Salon"})}),e.jsxs(D,{children:[e.jsx(y,{value:d,children:"Tất cả Salon"}),x.map(a=>e.jsx(y,{value:String(a.id),children:a.name},a.id))]})]}),e.jsxs(k,{value:n.categoryId||d,onValueChange:a=>c.categoryId(a===d?"":a),children:[e.jsx(w,{className:"w-full md:w-[200px]",children:e.jsx(q,{placeholder:"Lọc theo danh mục"})}),e.jsxs(D,{children:[e.jsx(y,{value:d,children:"Tất cả danh mục"}),s.map(a=>e.jsx(y,{value:String(a.id),children:a.name},a.id))]})]}),e.jsxs(k,{value:n.status||d,onValueChange:a=>c.status(a===d?"":a),children:[e.jsx(w,{className:"w-full md:w-[200px]",children:e.jsx(q,{placeholder:"Trạng thái"})}),e.jsxs(D,{children:[e.jsx(y,{value:d,children:"Tất cả trạng thái"}),e.jsx(y,{value:String(T.SHOW),children:"Đang hoạt động"}),e.jsx(y,{value:String(T.HIDDEN),children:"Tạm ngưng"})]})]})]})}function Fe({service:n,isOpen:c,onClose:s}){const{toast:x}=K(),[a,N]=P.useState(!1),m=$({mutationFn:fe,onSuccess:()=>{z.invalidateQueries({queryKey:["/api/services"]}),s(),x({title:"Thành công",description:"Dịch vụ đã được cập nhật."})},onError:b=>{x({title:"Lỗi",description:`Không thể cập nhật dịch vụ: ${b.message}`,variant:"destructive"})},onSettled:()=>N(!1)}),S=b=>{N(!0),m.mutate({id:n.id,data:b})};return e.jsx(U,{values:n,isEdit:!0,isLoading:a,onSubmit:S,isOpen:c,onClose:s,title:"Cập nhật dịch vụ",description:"Cập nhật thông tin dịch vụ"})}function on(){const[n,c]=P.useState(!1),[s,x]=P.useState(null),a=J(),{toast:N}=K(),{values:m,setters:S}=ye({name:{defaultValue:"",parse:r=>r,stringify:r=>r},salonId:{defaultValue:d,parse:r=>r,stringify:r=>r?String(r):d},categoryId:{defaultValue:d,parse:r=>r,stringify:r=>r?String(r):d},status:{defaultValue:d,parse:r=>r,stringify:r=>r?String(r):d},page:{defaultValue:1,parse:r=>Number(r)||1,stringify:r=>String(r)},size:{defaultValue:8,parse:r=>Number(r)||8,stringify:r=>String(r)}}),b=Ne({name:m.name,categoryId:m.categoryId===d?"":m.categoryId,salonId:m.salonId===d?"":m.salonId,status:m.status===d?"":m.status,page:m.page-1,size:m.size}),{data:{data:L=[],totalPage:O=1,currentPage:o=1}={},isLoading:I}=F({queryKey:["/api/services",b],queryFn:()=>Te(b)}),E=$({mutationFn:ke,onSuccess:()=>{N({title:"Xóa dịch vụ thành công",variant:"default"}),z.invalidateQueries({queryKey:["/api/services"]})},onError:()=>{N({title:"Xóa dịch vụ thất bại",variant:"destructive"})},onSettled:()=>{a(Z())}}),H=r=>{a(V()),E.mutate(r)},G=r=>{S.page(r)};return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"container mx-auto py-6",children:[e.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Dịch vụ"}),e.jsx("p",{className:"text-muted-foreground",children:"Quản lý danh sách dịch vụ"})]}),e.jsxs(f,{onClick:()=>c(!0),children:[e.jsx(Se,{className:"mr-2 h-4 w-4"}),"Thêm dịch vụ"]})]}),e.jsx(Pe,{filters:m,setFilters:S}),I?e.jsx(Y,{}):e.jsx("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4",children:L.map(r=>e.jsx(qe,{service:r,setEditingService:x,handleDeleteService:H},r.id))}),L.length===0&&!I&&e.jsx("div",{className:"col-span-1 flex h-40 items-center justify-center rounded-lg bg-gray-50 md:col-span-2 lg:col-span-3",children:e.jsx("p",{className:"text-gray-500",children:"Chưa có dịch vụ"})}),e.jsx(ve,{currentPage:o,totalPage:O,onPageChange:G}),e.jsx(De,{isOpen:n,onClose:()=>c(!1)}),s&&e.jsx(Fe,{isOpen:!!s,service:s,onClose:()=>x(null)})]})})}export{on as default};
