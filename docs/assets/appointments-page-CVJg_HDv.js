import{B as pe,r as l,j as e,c as fe,a as xe,u as K,P as ve,b as P,d as be,D as ye,C as Te,R as we,e as A,o as je,z as Ce,A as Ne}from"./index-Co3jKZaL.js";import{g as Y}from"./salon-DTDDsyB3.js";import{C as Pe,a as Se}from"./card-5fN4BC23.js";import{S as X,U as Me}from"./skeleton-Yd1LvKFE.js";import{b as De}from"./Combination-Bb8ckWgm.js";import{c as U,R as Ee,A as ke,C as Re,a as He}from"./index-C7ei8kKs.js";import{g as Ie}from"./staff-BQ08NgdR.js";import{B as M}from"./button-BNCUvJzd.js";import{P as J,a as Z,b as ee,C as te,i as _e,c as Le}from"./popover-Co-wHFZU.js";import{D as Ae,b as Oe,c as Fe,d as We,e as qe,f as Ve}from"./dialog-DsEfTekn.js";import{L as E}from"./label-BQaUV1Av.js";import{S as H,a as I,b as _,c as L,d as S}from"./select-CMLZ4ZLM.js";import{u as O}from"./useQuery-D61Jsyd7.js";import{u as ze}from"./useMutation-BSFioODP.js";import{C as ne}from"./calendar-pbP-nKA2.js";import{L as Be}from"./loader-circle-DuW_hbzs.js";import{b as B,a as k,c as R,d as $e,f as re}from"./format-Bki_VTC_.js";import{I as Qe}from"./info-DK0A6Nfs.js";import{C as Ge}from"./clock-CC5luRVp.js";import{u as Xe,a as Ke}from"./use-sync-url-states-W091DZhx.js";import{P as Ye}from"./plus-CAZAkEn4.js";import{C as Ue}from"./chevron-left-DiLf67sb.js";import{C as Je}from"./chevron-right-BVZHUiVw.js";import"./index-m_3Aq4-g.js";import"./index-BV-DTqk3.js";import"./isNumber-5m_zYJtK.js";const Ze=async n=>{const s={...n,...n.date&&{date:new Date(n.date).toISOString()}};return(await pe.get("/admin/appointment",{params:s})).data.result};var[W,Dn]=fe("Tooltip",[U]),q=U(),se="TooltipProvider",et=700,$="tooltip.open",[tt,G]=W(se),ae=n=>{const{__scopeTooltip:s,delayDuration:t=et,skipDelayDuration:r=300,disableHoverableContent:i=!1,children:m}=n,u=l.useRef(!0),v=l.useRef(!1),d=l.useRef(0);return l.useEffect(()=>{const b=d.current;return()=>window.clearTimeout(b)},[]),e.jsx(tt,{scope:s,isOpenDelayedRef:u,delayDuration:t,onOpen:l.useCallback(()=>{window.clearTimeout(d.current),u.current=!1},[]),onClose:l.useCallback(()=>{window.clearTimeout(d.current),d.current=window.setTimeout(()=>u.current=!0,r)},[r]),isPointerInTransitRef:v,onPointerInTransitChange:l.useCallback(b=>{v.current=b},[]),disableHoverableContent:i,children:m})};ae.displayName=se;var F="Tooltip",[nt,V]=W(F),oe=n=>{const{__scopeTooltip:s,children:t,open:r,defaultOpen:i,onOpenChange:m,disableHoverableContent:u,delayDuration:v}=n,d=G(F,n.__scopeTooltip),b=q(s),[g,f]=l.useState(null),o=De(),c=l.useRef(0),x=u??d.disableHoverableContent,a=v??d.delayDuration,p=l.useRef(!1),[T,y]=xe({prop:r,defaultProp:i??!1,onChange:N=>{N?(d.onOpen(),document.dispatchEvent(new CustomEvent($))):d.onClose(),m==null||m(N)},caller:F}),j=l.useMemo(()=>T?p.current?"delayed-open":"instant-open":"closed",[T]),w=l.useCallback(()=>{window.clearTimeout(c.current),c.current=0,p.current=!1,y(!0)},[y]),C=l.useCallback(()=>{window.clearTimeout(c.current),c.current=0,y(!1)},[y]),h=l.useCallback(()=>{window.clearTimeout(c.current),c.current=window.setTimeout(()=>{p.current=!0,y(!0),c.current=0},a)},[a,y]);return l.useEffect(()=>()=>{c.current&&(window.clearTimeout(c.current),c.current=0)},[]),e.jsx(Ee,{...b,children:e.jsx(nt,{scope:s,contentId:o,open:T,stateAttribute:j,trigger:g,onTriggerChange:f,onTriggerEnter:l.useCallback(()=>{d.isOpenDelayedRef.current?h():w()},[d.isOpenDelayedRef,h,w]),onTriggerLeave:l.useCallback(()=>{x?C():(window.clearTimeout(c.current),c.current=0)},[C,x]),onOpen:w,onClose:C,disableHoverableContent:x,children:t})})};oe.displayName=F;var Q="TooltipTrigger",ie=l.forwardRef((n,s)=>{const{__scopeTooltip:t,...r}=n,i=V(Q,t),m=G(Q,t),u=q(t),v=l.useRef(null),d=K(s,v,i.onTriggerChange),b=l.useRef(!1),g=l.useRef(!1),f=l.useCallback(()=>b.current=!1,[]);return l.useEffect(()=>()=>document.removeEventListener("pointerup",f),[f]),e.jsx(ke,{asChild:!0,...u,children:e.jsx(ve.button,{"aria-describedby":i.open?i.contentId:void 0,"data-state":i.stateAttribute,...r,ref:d,onPointerMove:P(n.onPointerMove,o=>{o.pointerType!=="touch"&&!g.current&&!m.isPointerInTransitRef.current&&(i.onTriggerEnter(),g.current=!0)}),onPointerLeave:P(n.onPointerLeave,()=>{i.onTriggerLeave(),g.current=!1}),onPointerDown:P(n.onPointerDown,()=>{i.open&&i.onClose(),b.current=!0,document.addEventListener("pointerup",f,{once:!0})}),onFocus:P(n.onFocus,()=>{b.current||i.onOpen()}),onBlur:P(n.onBlur,i.onClose),onClick:P(n.onClick,i.onClose)})})});ie.displayName=Q;var rt="TooltipPortal",[En,st]=W(rt,{forceMount:void 0}),D="TooltipContent",le=l.forwardRef((n,s)=>{const t=st(D,n.__scopeTooltip),{forceMount:r=t.forceMount,side:i="top",...m}=n,u=V(D,n.__scopeTooltip);return e.jsx(be,{present:r||u.open,children:u.disableHoverableContent?e.jsx(ce,{side:i,...m,ref:s}):e.jsx(at,{side:i,...m,ref:s})})}),at=l.forwardRef((n,s)=>{const t=V(D,n.__scopeTooltip),r=G(D,n.__scopeTooltip),i=l.useRef(null),m=K(s,i),[u,v]=l.useState(null),{trigger:d,onClose:b}=t,g=i.current,{onPointerInTransitChange:f}=r,o=l.useCallback(()=>{v(null),f(!1)},[f]),c=l.useCallback((x,a)=>{const p=x.currentTarget,T={x:x.clientX,y:x.clientY},y=dt(T,p.getBoundingClientRect()),j=ht(T,y),w=ut(a.getBoundingClientRect()),C=gt([...j,...w]);v(C),f(!0)},[f]);return l.useEffect(()=>()=>o(),[o]),l.useEffect(()=>{if(d&&g){const x=p=>c(p,g),a=p=>c(p,d);return d.addEventListener("pointerleave",x),g.addEventListener("pointerleave",a),()=>{d.removeEventListener("pointerleave",x),g.removeEventListener("pointerleave",a)}}},[d,g,c,o]),l.useEffect(()=>{if(u){const x=a=>{const p=a.target,T={x:a.clientX,y:a.clientY},y=(d==null?void 0:d.contains(p))||(g==null?void 0:g.contains(p)),j=!mt(T,u);y?o():j&&(o(),b())};return document.addEventListener("pointermove",x),()=>document.removeEventListener("pointermove",x)}},[d,g,u,b,o]),e.jsx(ce,{...n,ref:m})}),[ot,it]=W(F,{isInside:!1}),lt=Te("TooltipContent"),ce=l.forwardRef((n,s)=>{const{__scopeTooltip:t,children:r,"aria-label":i,onEscapeKeyDown:m,onPointerDownOutside:u,...v}=n,d=V(D,t),b=q(t),{onClose:g}=d;return l.useEffect(()=>(document.addEventListener($,g),()=>document.removeEventListener($,g)),[g]),l.useEffect(()=>{if(d.trigger){const f=o=>{const c=o.target;c!=null&&c.contains(d.trigger)&&g()};return window.addEventListener("scroll",f,{capture:!0}),()=>window.removeEventListener("scroll",f,{capture:!0})}},[d.trigger,g]),e.jsx(ye,{asChild:!0,disableOutsidePointerEvents:!1,onEscapeKeyDown:m,onPointerDownOutside:u,onFocusOutside:f=>f.preventDefault(),onDismiss:g,children:e.jsxs(Re,{"data-state":d.stateAttribute,...b,...v,ref:s,style:{...v.style,"--radix-tooltip-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-tooltip-content-available-width":"var(--radix-popper-available-width)","--radix-tooltip-content-available-height":"var(--radix-popper-available-height)","--radix-tooltip-trigger-width":"var(--radix-popper-anchor-width)","--radix-tooltip-trigger-height":"var(--radix-popper-anchor-height)"},children:[e.jsx(lt,{children:r}),e.jsx(ot,{scope:t,isInside:!0,children:e.jsx(we,{id:d.contentId,role:"tooltip",children:i||r})})]})})});le.displayName=D;var de="TooltipArrow",ct=l.forwardRef((n,s)=>{const{__scopeTooltip:t,...r}=n,i=q(t);return it(de,t).isInside?null:e.jsx(He,{...i,...r,ref:s})});ct.displayName=de;function dt(n,s){const t=Math.abs(s.top-n.y),r=Math.abs(s.bottom-n.y),i=Math.abs(s.right-n.x),m=Math.abs(s.left-n.x);switch(Math.min(t,r,i,m)){case m:return"left";case i:return"right";case t:return"top";case r:return"bottom";default:throw new Error("unreachable")}}function ht(n,s,t=5){const r=[];switch(s){case"top":r.push({x:n.x-t,y:n.y+t},{x:n.x+t,y:n.y+t});break;case"bottom":r.push({x:n.x-t,y:n.y-t},{x:n.x+t,y:n.y-t});break;case"left":r.push({x:n.x+t,y:n.y-t},{x:n.x+t,y:n.y+t});break;case"right":r.push({x:n.x-t,y:n.y-t},{x:n.x-t,y:n.y+t});break}return r}function ut(n){const{top:s,right:t,bottom:r,left:i}=n;return[{x:i,y:s},{x:t,y:s},{x:t,y:r},{x:i,y:r}]}function mt(n,s){const{x:t,y:r}=n;let i=!1;for(let m=0,u=s.length-1;m<s.length;u=m++){const v=s[m],d=s[u],b=v.x,g=v.y,f=d.x,o=d.y;g>r!=o>r&&t<(f-b)*(r-g)/(o-g)+b&&(i=!i)}return i}function gt(n){const s=n.slice();return s.sort((t,r)=>t.x<r.x?-1:t.x>r.x?1:t.y<r.y?-1:t.y>r.y?1:0),pt(s)}function pt(n){if(n.length<=1)return n.slice();const s=[];for(let r=0;r<n.length;r++){const i=n[r];for(;s.length>=2;){const m=s[s.length-1],u=s[s.length-2];if((m.x-u.x)*(i.y-u.y)>=(m.y-u.y)*(i.x-u.x))s.pop();else break}s.push(i)}s.pop();const t=[];for(let r=n.length-1;r>=0;r--){const i=n[r];for(;t.length>=2;){const m=t[t.length-1],u=t[t.length-2];if((m.x-u.x)*(i.y-u.y)>=(m.y-u.y)*(i.x-u.x))t.pop();else break}t.push(i)}return t.pop(),s.length===1&&t.length===1&&s[0].x===t[0].x&&s[0].y===t[0].y?s:s.concat(t)}var ft=ae,xt=oe,vt=ie,bt=le;const yt=ft,Tt=xt,wt=vt,jt=l.forwardRef(({className:n,sideOffset:s=4,...t},r)=>e.jsx(bt,{ref:r,sideOffset:s,className:A("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",n),...t})),Ct={lessThanXSeconds:{one:"dưới 1 giây",other:"dưới {{count}} giây"},xSeconds:{one:"1 giây",other:"{{count}} giây"},halfAMinute:"nửa phút",lessThanXMinutes:{one:"dưới 1 phút",other:"dưới {{count}} phút"},xMinutes:{one:"1 phút",other:"{{count}} phút"},aboutXHours:{one:"khoảng 1 giờ",other:"khoảng {{count}} giờ"},xHours:{one:"1 giờ",other:"{{count}} giờ"},xDays:{one:"1 ngày",other:"{{count}} ngày"},aboutXWeeks:{one:"khoảng 1 tuần",other:"khoảng {{count}} tuần"},xWeeks:{one:"1 tuần",other:"{{count}} tuần"},aboutXMonths:{one:"khoảng 1 tháng",other:"khoảng {{count}} tháng"},xMonths:{one:"1 tháng",other:"{{count}} tháng"},aboutXYears:{one:"khoảng 1 năm",other:"khoảng {{count}} năm"},xYears:{one:"1 năm",other:"{{count}} năm"},overXYears:{one:"hơn 1 năm",other:"hơn {{count}} năm"},almostXYears:{one:"gần 1 năm",other:"gần {{count}} năm"}},Nt=(n,s,t)=>{let r;const i=Ct[n];return typeof i=="string"?r=i:s===1?r=i.one:r=i.other.replace("{{count}}",String(s)),t!=null&&t.addSuffix?t.comparison&&t.comparison>0?r+" nữa":r+" trước":r},Pt={full:"EEEE, 'ngày' d MMMM 'năm' y",long:"'ngày' d MMMM 'năm' y",medium:"d MMM 'năm' y",short:"dd/MM/y"},St={full:"HH:mm:ss zzzz",long:"HH:mm:ss z",medium:"HH:mm:ss",short:"HH:mm"},Mt={full:"{{date}} {{time}}",long:"{{date}} {{time}}",medium:"{{date}} {{time}}",short:"{{date}} {{time}}"},Dt={date:B({formats:Pt,defaultWidth:"full"}),time:B({formats:St,defaultWidth:"full"}),dateTime:B({formats:Mt,defaultWidth:"full"})},Et={lastWeek:"eeee 'tuần trước vào lúc' p",yesterday:"'hôm qua vào lúc' p",today:"'hôm nay vào lúc' p",tomorrow:"'ngày mai vào lúc' p",nextWeek:"eeee 'tới vào lúc' p",other:"P"},kt=(n,s,t,r)=>Et[n],Rt={narrow:["TCN","SCN"],abbreviated:["trước CN","sau CN"],wide:["trước Công Nguyên","sau Công Nguyên"]},Ht={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["Quý 1","Quý 2","Quý 3","Quý 4"]},It={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["quý I","quý II","quý III","quý IV"]},_t={narrow:["1","2","3","4","5","6","7","8","9","10","11","12"],abbreviated:["Thg 1","Thg 2","Thg 3","Thg 4","Thg 5","Thg 6","Thg 7","Thg 8","Thg 9","Thg 10","Thg 11","Thg 12"],wide:["Tháng Một","Tháng Hai","Tháng Ba","Tháng Tư","Tháng Năm","Tháng Sáu","Tháng Bảy","Tháng Tám","Tháng Chín","Tháng Mười","Tháng Mười Một","Tháng Mười Hai"]},Lt={narrow:["01","02","03","04","05","06","07","08","09","10","11","12"],abbreviated:["thg 1","thg 2","thg 3","thg 4","thg 5","thg 6","thg 7","thg 8","thg 9","thg 10","thg 11","thg 12"],wide:["tháng 01","tháng 02","tháng 03","tháng 04","tháng 05","tháng 06","tháng 07","tháng 08","tháng 09","tháng 10","tháng 11","tháng 12"]},At={narrow:["CN","T2","T3","T4","T5","T6","T7"],short:["CN","Th 2","Th 3","Th 4","Th 5","Th 6","Th 7"],abbreviated:["CN","Thứ 2","Thứ 3","Thứ 4","Thứ 5","Thứ 6","Thứ 7"],wide:["Chủ Nhật","Thứ Hai","Thứ Ba","Thứ Tư","Thứ Năm","Thứ Sáu","Thứ Bảy"]},Ot={narrow:{am:"am",pm:"pm",midnight:"nửa đêm",noon:"tr",morning:"sg",afternoon:"ch",evening:"tối",night:"đêm"},abbreviated:{am:"AM",pm:"PM",midnight:"nửa đêm",noon:"trưa",morning:"sáng",afternoon:"chiều",evening:"tối",night:"đêm"},wide:{am:"SA",pm:"CH",midnight:"nửa đêm",noon:"trưa",morning:"sáng",afternoon:"chiều",evening:"tối",night:"đêm"}},Ft={narrow:{am:"am",pm:"pm",midnight:"nửa đêm",noon:"tr",morning:"sg",afternoon:"ch",evening:"tối",night:"đêm"},abbreviated:{am:"AM",pm:"PM",midnight:"nửa đêm",noon:"trưa",morning:"sáng",afternoon:"chiều",evening:"tối",night:"đêm"},wide:{am:"SA",pm:"CH",midnight:"nửa đêm",noon:"giữa trưa",morning:"vào buổi sáng",afternoon:"vào buổi chiều",evening:"vào buổi tối",night:"vào ban đêm"}},Wt=(n,s)=>{const t=Number(n),r=s==null?void 0:s.unit;if(r==="quarter")switch(t){case 1:return"I";case 2:return"II";case 3:return"III";case 4:return"IV"}else if(r==="day")switch(t){case 1:return"thứ 2";case 2:return"thứ 3";case 3:return"thứ 4";case 4:return"thứ 5";case 5:return"thứ 6";case 6:return"thứ 7";case 7:return"chủ nhật"}else{if(r==="week")return t===1?"thứ nhất":"thứ "+t;if(r==="dayOfYear")return t===1?"đầu tiên":"thứ "+t}return String(t)},qt={ordinalNumber:Wt,era:k({values:Rt,defaultWidth:"wide"}),quarter:k({values:Ht,defaultWidth:"wide",formattingValues:It,defaultFormattingWidth:"wide",argumentCallback:n=>n-1}),month:k({values:_t,defaultWidth:"wide",formattingValues:Lt,defaultFormattingWidth:"wide"}),day:k({values:At,defaultWidth:"wide"}),dayPeriod:k({values:Ot,defaultWidth:"wide",formattingValues:Ft,defaultFormattingWidth:"wide"})},Vt=/^(\d+)/i,zt=/\d+/i,Bt={narrow:/^(tcn|scn)/i,abbreviated:/^(trước CN|sau CN)/i,wide:/^(trước Công Nguyên|sau Công Nguyên)/i},$t={any:[/^t/i,/^s/i]},Qt={narrow:/^([1234]|i{1,3}v?)/i,abbreviated:/^q([1234]|i{1,3}v?)/i,wide:/^quý ([1234]|i{1,3}v?)/i},Gt={any:[/(1|i)$/i,/(2|ii)$/i,/(3|iii)$/i,/(4|iv)$/i]},Xt={narrow:/^(0?[2-9]|10|11|12|0?1)/i,abbreviated:/^thg[ _]?(0?[1-9](?!\d)|10|11|12)/i,wide:/^tháng ?(Một|Hai|Ba|Tư|Năm|Sáu|Bảy|Tám|Chín|Mười|Mười ?Một|Mười ?Hai|0?[1-9](?!\d)|10|11|12)/i},Kt={narrow:[/0?1$/i,/0?2/i,/3/,/4/,/5/,/6/,/7/,/8/,/9/,/10/,/11/,/12/],abbreviated:[/^thg[ _]?0?1(?!\d)/i,/^thg[ _]?0?2/i,/^thg[ _]?0?3/i,/^thg[ _]?0?4/i,/^thg[ _]?0?5/i,/^thg[ _]?0?6/i,/^thg[ _]?0?7/i,/^thg[ _]?0?8/i,/^thg[ _]?0?9/i,/^thg[ _]?10/i,/^thg[ _]?11/i,/^thg[ _]?12/i],wide:[/^tháng ?(Một|0?1(?!\d))/i,/^tháng ?(Hai|0?2)/i,/^tháng ?(Ba|0?3)/i,/^tháng ?(Tư|0?4)/i,/^tháng ?(Năm|0?5)/i,/^tháng ?(Sáu|0?6)/i,/^tháng ?(Bảy|0?7)/i,/^tháng ?(Tám|0?8)/i,/^tháng ?(Chín|0?9)/i,/^tháng ?(Mười|10)/i,/^tháng ?(Mười ?Một|11)/i,/^tháng ?(Mười ?Hai|12)/i]},Yt={narrow:/^(CN|T2|T3|T4|T5|T6|T7)/i,short:/^(CN|Th ?2|Th ?3|Th ?4|Th ?5|Th ?6|Th ?7)/i,abbreviated:/^(CN|Th ?2|Th ?3|Th ?4|Th ?5|Th ?6|Th ?7)/i,wide:/^(Chủ ?Nhật|Chúa ?Nhật|thứ ?Hai|thứ ?Ba|thứ ?Tư|thứ ?Năm|thứ ?Sáu|thứ ?Bảy)/i},Ut={narrow:[/CN/i,/2/i,/3/i,/4/i,/5/i,/6/i,/7/i],short:[/CN/i,/2/i,/3/i,/4/i,/5/i,/6/i,/7/i],abbreviated:[/CN/i,/2/i,/3/i,/4/i,/5/i,/6/i,/7/i],wide:[/(Chủ|Chúa) ?Nhật/i,/Hai/i,/Ba/i,/Tư/i,/Năm/i,/Sáu/i,/Bảy/i]},Jt={narrow:/^(a|p|nửa đêm|trưa|(giờ) (sáng|chiều|tối|đêm))/i,abbreviated:/^(am|pm|nửa đêm|trưa|(giờ) (sáng|chiều|tối|đêm))/i,wide:/^(ch[^i]*|sa|nửa đêm|trưa|(giờ) (sáng|chiều|tối|đêm))/i},Zt={any:{am:/^(a|sa)/i,pm:/^(p|ch[^i]*)/i,midnight:/nửa đêm/i,noon:/trưa/i,morning:/sáng/i,afternoon:/chiều/i,evening:/tối/i,night:/^đêm/i}},en={ordinalNumber:$e({matchPattern:Vt,parsePattern:zt,valueCallback:n=>parseInt(n,10)}),era:R({matchPatterns:Bt,defaultMatchWidth:"wide",parsePatterns:$t,defaultParseWidth:"any"}),quarter:R({matchPatterns:Qt,defaultMatchWidth:"wide",parsePatterns:Gt,defaultParseWidth:"any",valueCallback:n=>n+1}),month:R({matchPatterns:Xt,defaultMatchWidth:"wide",parsePatterns:Kt,defaultParseWidth:"wide"}),day:R({matchPatterns:Yt,defaultMatchWidth:"wide",parsePatterns:Ut,defaultParseWidth:"wide"}),dayPeriod:R({matchPatterns:Jt,defaultMatchWidth:"wide",parsePatterns:Zt,defaultParseWidth:"any"})},he={code:"vi",formatDistance:Nt,formatLong:Dt,formatRelative:kt,localize:qt,match:en,options:{weekStartsOn:1,firstWeekContainsDate:1}};function ue({open:n,onOpenChange:s,initialDate:t,initialServiceId:r,initialStaffId:i,initialSalonId:m}){const{toast:u}=je(),[v,d]=l.useState(t),[b,g]=l.useState("09:00"),[f,o]=l.useState(r),[c,x]=l.useState(i),[a,p]=l.useState(m);l.useEffect(()=>{n&&(d(t),g("09:00"),o(r),x(i),p(m))},[n,t,r,i,m]);const{data:{data:T=[]}={}}=O({queryKey:["/api/services/salons"],queryFn:Y}),{data:y=[]}=O({queryKey:["/api/services",a],queryFn:async()=>{const h=new URLSearchParams(a?{salonId:a.toString()}:{}),N=await fetch(`/api/services?${h.toString()}`);if(!N.ok)throw new Error("Failed to fetch services");return N.json()},enabled:!!a}),{data:{data:j=[]}={}}=O({queryKey:["/api/staff",a],queryFn:()=>Ie({salonId:a==null?void 0:a.toString()}),enabled:!!a}),w=ze({mutationFn:async()=>{if(!v||!f||!c||!a)throw new Error("Missing required fields");const h=new Date(v),[N,me]=b.split(":").map(Number);h.setHours(N,me,0,0);const z=await Ne("POST","/api/appointments",{date:h.toISOString(),serviceId:f,staffId:c,salonId:a});if(!z.ok){const ge=await z.json();throw new Error(ge.message||"Failed to create appointment")}return z.json()},onSuccess:()=>{Ce.invalidateQueries({queryKey:["/api/appointments"]}),u({title:"Thành công",description:"Lịch hẹn đã được tạo"}),s(!1)},onError:h=>{u({title:"Lỗi",description:`Không thể tạo lịch hẹn: ${h.message}`,variant:"destructive"})}}),C=()=>{w.mutate()};return e.jsx(Ae,{open:n,onOpenChange:s,children:e.jsxs(Oe,{className:"sm:max-w-[425px]",children:[e.jsxs(Fe,{children:[e.jsx(We,{children:"Tạo lịch hẹn mới"}),e.jsx(qe,{children:"Điền thông tin để tạo lịch hẹn mới"})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(E,{children:"Salon"}),e.jsxs(H,{value:a==null?void 0:a.toString(),onValueChange:h=>p(Number(h)),children:[e.jsx(I,{children:e.jsx(_,{placeholder:"Chọn salon"})}),e.jsx(L,{children:T.map(h=>e.jsx(S,{value:h.id.toString(),children:h.name},h.id))})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(E,{children:"Dịch vụ"}),e.jsxs(H,{value:f==null?void 0:f.toString(),onValueChange:h=>o(Number(h)),disabled:!a,children:[e.jsx(I,{children:e.jsx(_,{placeholder:"Chọn dịch vụ"})}),e.jsx(L,{children:y.map(h=>e.jsx(S,{value:h.id.toString(),children:h.name},h.id))})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(E,{children:"Nhân viên"}),e.jsxs(H,{value:c==null?void 0:c.toString(),onValueChange:h=>x(Number(h)),disabled:!a,children:[e.jsx(I,{children:e.jsx(_,{placeholder:"Chọn nhân viên"})}),e.jsx(L,{children:j.map(h=>e.jsx(S,{value:h.id.toString(),children:h.user.name},h.id))})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(E,{children:"Ngày"}),e.jsxs(J,{children:[e.jsx(Z,{asChild:!0,children:e.jsxs(M,{variant:"outline",className:A("w-full justify-start text-left font-normal",!v&&"text-muted-foreground"),children:[e.jsx(ne,{className:"mr-2 h-4 w-4"}),v?re(v,"PPP",{locale:he}):e.jsx("span",{children:"Chọn ngày"})]})}),e.jsx(ee,{className:"w-auto p-0",align:"start",children:e.jsx(te,{mode:"single",selected:v,onSelect:d,initialFocus:!0,disabled:h=>h<new Date})})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(E,{children:"Giờ"}),e.jsxs(H,{value:b,onValueChange:g,children:[e.jsx(I,{children:e.jsx(_,{placeholder:"Chọn giờ"})}),e.jsx(L,{children:Array.from({length:24},(h,N)=>N).map(h=>e.jsxs(l.Fragment,{children:[e.jsx(S,{value:`${h.toString().padStart(2,"0")}:00`,children:`${h.toString().padStart(2,"0")}:00`}),e.jsx(S,{value:`${h.toString().padStart(2,"0")}:30`,children:`${h.toString().padStart(2,"0")}:30`})]},h))})]})]})]}),e.jsx(Ve,{children:e.jsxs(M,{onClick:C,disabled:w.isPending,children:[w.isPending&&e.jsx(Be,{className:"mr-2 h-4 w-4 animate-spin"}),"Tạo lịch hẹn"]})})]})})}function tn({selectedDate:n=new Date,appointments:s,isLoading:t}){const[r,i]=l.useState(!1),[m,u]=l.useState(void 0),[v,d]=l.useState(void 0),b=l.useMemo(()=>{if(s.length===0)return[];const o=new Set;return s[0].freeHours.forEach(c=>{c.hours.forEach(x=>{o.add(x.hourFrame)})}),Array.from(o).sort((c,x)=>{const[a,p]=c.split(":").map(Number),[T,y]=x.split(":").map(Number);return a*60+p-(T*60+y)})},[s]),g=(o,c)=>{const[x,a]=o.split(":").map(Number),p=new Date(n);p.setHours(x,a,0,0),u(p),d(c),i(!0)},f=(o,c)=>s.filter(x=>x.user.id!==o?!1:x.freeHours.some(a=>a.hours.some(p=>p.hourFrame===c)));return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"mb-4 flex items-center justify-end",children:e.jsxs("div",{className:"flex flex-wrap items-center justify-end gap-3 text-xs",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"size-3 rounded border border-green-200 bg-green-100"}),e.jsx("span",{children:"Đã xác nhận"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"size-3 rounded border border-yellow-200 bg-yellow-100"}),e.jsx("span",{children:"Chờ xác nhận"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"size-3 rounded border border-red-200 bg-red-100"}),e.jsx("span",{children:"Đã hủy"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"size-3 rounded border border-blue-200 bg-blue-100"}),e.jsx("span",{children:"Hoàn thành"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"size-3 rounded border border-gray-200 bg-gray-100"}),e.jsx("span",{children:"Trống"})]})]})}),e.jsx(Pe,{children:e.jsx(Se,{className:"p-0",children:e.jsx("div",{className:"overflow-x-auto",style:{position:"relative"},children:e.jsxs("table",{className:"w-full border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"sticky left-0 z-10 border border-border bg-background p-3 text-left font-medium",style:{width:"250px",minWidth:"250px",maxWidth:"250px"},children:"NV / Giờ"}),b.map(o=>e.jsx("th",{className:"min-w-[100px] border border-border bg-muted/50 p-3 text-center font-medium",children:o},o))]})}),e.jsxs("tbody",{children:[t&&Array.from({length:3}).map((o,c)=>e.jsxs("tr",{children:[e.jsx("td",{className:"sticky left-0 z-10 border border-border bg-background p-3",children:e.jsx(X,{className:"h-5 w-32"})}),Array.from({length:b.length}).map((x,a)=>e.jsx("td",{className:"border border-border p-3",children:e.jsx(X,{className:"h-8 w-full"})},`slot-skeleton-${c}-${a}`))]},`staff-skeleton-${c}`)),!t&&s.map(o=>e.jsxs("tr",{children:[e.jsx("td",{className:"sticky left-0 z-10 border border-border bg-background p-3 font-medium",style:{width:"250px",minWidth:"250px",maxWidth:"250px"},children:o.user.name}),b.map(c=>{const a=f(o.user.id,c)[0],p=a==null?void 0:a.freeHours.some(C=>C.hours.some(h=>h.hourFrame===c&&h.isFree)),[T,y]=c.split(":").map(Number),j=new Date(n);j.setHours(T,y,0,0);const w=_e(j,new Date);return e.jsx("td",{className:A("h-12 min-h-10 border border-border p-3 text-center",{"opacity-60":w,"cursor-pointer bg-gray-100 hover:bg-gray-200":p,"bg-green-100 hover:bg-green-200":!p&&(a==null?void 0:a.status)==="confirmed","bg-yellow-100 hover:bg-yellow-200":!p&&(a==null?void 0:a.status)==="pending","bg-red-100 hover:bg-red-200":!p&&(a==null?void 0:a.status)==="cancelled","bg-blue-100 hover:bg-blue-200":!p&&(a==null?void 0:a.status)==="completed"}),onClick:()=>{p&&!w&&g(c,o.user.id)},children:!p&&a?e.jsx(yt,{children:e.jsxs(Tt,{children:[e.jsx(wt,{asChild:!0,children:e.jsx("div",{className:A("font-medium",{"text-green-700":a.status==="confirmed","text-yellow-700":a.status==="pending","text-red-700":a.status==="cancelled","text-blue-700":a.status==="completed"}),children:a.user.name})}),e.jsx(jt,{className:"border-2 bg-white font-semibold shadow-lg",children:e.jsxs("div",{className:"space-y-1 text-xs text-gray-800",children:[e.jsxs("div",{className:"font-bold text-black",children:["Lịch hẹn #",a.id]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Me,{className:"size-3"}),a.user.name]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Qe,{className:"size-3"}),"Trạng thái:"," ",e.jsx("span",{className:A("font-bold",{"text-green-600":a.status==="confirmed","text-yellow-600":a.status==="pending","text-red-600":a.status==="cancelled","text-blue-600":a.status==="completed"}),children:a.status==="confirmed"?"Đã xác nhận":a.status==="pending"?"Chờ xác nhận":a.status==="cancelled"?"Đã hủy":"Hoàn thành"})]}),a.description&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Ge,{className:"size-3"}),a.description]})]})})]})}):e.jsx("div",{className:"text-gray-500",children:"Trống"})},`${o.id}-${c}`)})]},o.id))]})]})})})}),e.jsx(ue,{open:r,onOpenChange:i,initialDate:m,initialStaffId:v})]})}function kn(){const[n,s]=l.useState(!1),t=l.useRef(new Date),{values:r,setters:i}=Xe({date:{defaultValue:t.current,parse:o=>new Date(o),stringify:o=>o.toISOString()},salonId:{defaultValue:"",parse:o=>o,stringify:o=>o?String(o):""}}),{data:{data:m=[]}={}}=O({queryKey:["/api/services/salons"],queryFn:Y}),u=Ke({salonId:r.salonId||r.salonId,date:r.date}),{data:{data:v=[]}={},isLoading:d}=O({queryKey:["/api/appointments",u],queryFn:()=>Ze(u)}),b=()=>{s(!0)},g=()=>{const o=new Date(r.date);o.setDate(o.getDate()-1),i.date(o)},f=()=>{const o=new Date(r.date);o.setDate(o.getDate()+1),i.date(o)};return e.jsxs("div",{children:[e.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"font-heading text-2xl font-bold text-neutral-900",children:"Lịch hẹn"}),e.jsx("p",{className:"text-neutral-600",children:"Quản lý tất cả các lịch hẹn salon"})]}),e.jsxs(M,{onClick:b,children:[e.jsx(Ye,{className:"mr-2 size-4"}),"Tạo lịch hẹn mới"]})]}),e.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[e.jsxs(H,{value:r.salonId,onValueChange:o=>i.salonId(o),children:[e.jsx(I,{className:"w-[200px]",children:e.jsx(_,{placeholder:"Chọn salon"})}),e.jsx(L,{children:m.map(o=>e.jsx(S,{value:String(o.id),children:o.name},o.id))})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(M,{variant:"outline",size:"sm",onClick:g,children:e.jsx(Ue,{className:"h-4 w-4"})}),e.jsxs(J,{children:[e.jsx(Z,{asChild:!0,children:e.jsxs(M,{variant:"outline",className:"min-w-[240px] px-4",children:[e.jsx(ne,{className:"mr-2 h-4 w-4"}),Le(r.date,new Date)?"Hôm nay":re(r.date,"EEEE, dd/MM/yyyy",{locale:he})]})}),e.jsx(ee,{className:"w-auto p-0",align:"start",children:e.jsx(te,{mode:"single",selected:r.date,onSelect:o=>o&&i.date(o),initialFocus:!0})})]}),e.jsx(M,{variant:"outline",size:"sm",onClick:f,children:e.jsx(Je,{className:"h-4 w-4"})})]})]}),e.jsx(tn,{selectedDate:r.date,appointments:v,isLoading:d}),e.jsx(ue,{open:n,onOpenChange:s,initialDate:r.date,initialSalonId:Number(r.salonId)})]})}export{kn as default};
