import{f as Z,r as T,j as e}from"./index-Dj3cS6za.js";import{B as u}from"./button-Crtod_yx.js";import{s as I,P as ee,a as se,b as ae,C as K,c as te,e as ne}from"./popover-DWJz2dMU.js";import{C as c,b as h,c as d,a as x,d as b,e as ie}from"./card-C8qa4OaK.js";import{S as M,a as B,b as O,c as $,d as g}from"./select-Ck2txczR.js";import{T as E,a as H,b as w,c as t,d as V,e as n}from"./table-Bh6-j-BX.js";import{T as le,a as re,b as k,c as A}from"./tabs-CpJS4XpB.js";import{u as R}from"./useQuery-Q6h1jA1k.js";import{C as ce}from"./calendar-B3ImGPjP.js";import{L as o}from"./loader-circle-Bl7EfNa1.js";import{A as F,a as he,R as q,B as de,C as xe,X as oe,Y as z,T as Y,L as me,b as X,P as je,c as ue,d as ge}from"./PieChart-5OnbAJyJ.js";import{f as _}from"./format-C_m1koB7.js";import"./chevron-left-BV-eJxQL.js";import"./chevron-right-HV8dK0o4.js";import"./Combination-27LuzUOQ.js";import"./index-CF79JPbI.js";import"./index-BGWUGcaw.js";import"./index-DvGPzrVe.js";import"./check-sEMdCc3q.js";import"./index-Cq9-3w0A.js";import"./index-BhW-rcdq.js";/**
 * @license lucide-react v0.488.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pe=[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]],ve=Z("download",pe);function He(){const[i,G]=T.useState("month"),[m,v]=T.useState(I(new Date,30)),[j,f]=T.useState(new Date),y=s=>{G(s);const a=new Date;switch(s){case"week":v(I(a,7)),f(a);break;case"month":v(te(a)),f(ne(a));break;case"year":v(new Date(a.getFullYear(),0,1)),f(new Date(a.getFullYear(),11,31));break}},Q=()=>i==="custom"?`${_(m,"dd/MM/yyyy")} - ${_(j,"dd/MM/yyyy")}`:{week:"7 ngày qua",month:"Tháng này",year:"Năm nay"}[i],{data:l,isLoading:N}=R({queryKey:["/api/reports/revenue",m.toISOString(),j.toISOString()]}),{data:r,isLoading:L}=R({queryKey:["/api/reports/services",m.toISOString(),j.toISOString()]}),{data:C,isLoading:U}=R({queryKey:["/api/reports/staff",m.toISOString(),j.toISOString()]}),P=["#6A2C70","#8A4F96","#177E89","#1A9DAB","#125F67","#4CAF50","#F44336","#FFC107"],p=(()=>{if(!l)return{totalRevenue:0,totalAppointments:0,avgDaily:0};const s=l.reduce((S,D)=>S+D.revenue,0),a=l.reduce((S,D)=>S+D.appointments,0),J=l.length||1,W=s/J;return{totalRevenue:s,totalAppointments:a,avgDaily:W}})();return e.jsxs("div",{children:[e.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"font-heading text-2xl font-bold text-neutral-900",children:"Báo cáo & Thống kê"}),e.jsx("p",{className:"text-neutral-600",children:"Phân tích hiệu suất kinh doanh của salon"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(ee,{children:[e.jsx(se,{asChild:!0,children:e.jsxs(u,{variant:"outline",className:"w-auto justify-start",children:[e.jsx(ce,{className:"mr-2 h-4 w-4"}),Q()]})}),e.jsx(ae,{className:"w-auto p-4",align:"end",children:e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-medium",children:"Chọn khoảng thời gian"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx(u,{variant:i==="week"?"default":"outline",size:"sm",onClick:()=>y("week"),children:"7 ngày"}),e.jsx(u,{variant:i==="month"?"default":"outline",size:"sm",onClick:()=>y("month"),children:"Tháng này"}),e.jsx(u,{variant:i==="year"?"default":"outline",size:"sm",onClick:()=>y("year"),children:"Năm nay"}),e.jsx(u,{variant:i==="custom"?"default":"outline",size:"sm",onClick:()=>y("custom"),children:"Tùy chỉnh"})]})]}),i==="custom"&&e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-medium",children:"Từ ngày"}),e.jsx(K,{mode:"single",selected:m,onSelect:s=>s&&v(s),disabled:s=>s>j||s>new Date,initialFocus:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-medium",children:"Đến ngày"}),e.jsx(K,{mode:"single",selected:j,onSelect:s=>s&&f(s),disabled:s=>s<m||s>new Date,initialFocus:!0})]})]})]})})]}),e.jsxs(u,{variant:"outline",children:[e.jsx(ve,{className:"mr-2 h-4 w-4"}),"Xuất báo cáo"]})]})]}),e.jsxs("div",{className:"mb-6 grid grid-cols-1 gap-4 md:grid-cols-3",children:[e.jsxs(c,{children:[e.jsx(h,{className:"pb-2",children:e.jsx(d,{className:"text-sm text-gray-500",children:"Tổng doanh thu"})}),e.jsxs(x,{children:[e.jsx("div",{className:"text-2xl font-bold",children:N?e.jsx(o,{className:"h-6 w-6 animate-spin text-primary"}):`${(p.totalRevenue/1e6).toFixed(2)}M ₫`}),e.jsx("div",{className:"mt-1 flex items-center text-sm",children:e.jsxs("span",{className:`flex items-center text-xs ${p.totalRevenue>0?"text-green-600":"text-red-600"}`,children:[p.totalRevenue>0?e.jsx(F,{className:"mr-1 h-3 w-3"}):e.jsx(he,{className:"mr-1 h-3 w-3"}),"12% so với kỳ trước"]})})]})]}),e.jsxs(c,{children:[e.jsx(h,{className:"pb-2",children:e.jsx(d,{className:"text-sm text-gray-500",children:"Tổng số lịch hẹn"})}),e.jsxs(x,{children:[e.jsx("div",{className:"text-2xl font-bold",children:N?e.jsx(o,{className:"h-6 w-6 animate-spin text-primary"}):p.totalAppointments}),e.jsx("div",{className:"mt-1 flex items-center text-sm",children:e.jsxs("span",{className:"flex items-center text-xs text-green-600",children:[e.jsx(F,{className:"mr-1 h-3 w-3"}),"8% so với kỳ trước"]})})]})]}),e.jsxs(c,{children:[e.jsx(h,{className:"pb-2",children:e.jsx(d,{className:"text-sm text-gray-500",children:"Doanh thu trung bình / ngày"})}),e.jsxs(x,{children:[e.jsx("div",{className:"text-2xl font-bold",children:N?e.jsx(o,{className:"h-6 w-6 animate-spin text-primary"}):`${(p.avgDaily/1e6).toFixed(2)}M ₫`}),e.jsx("div",{className:"mt-1 flex items-center text-sm",children:e.jsxs("span",{className:"flex items-center text-xs text-green-600",children:[e.jsx(F,{className:"mr-1 h-3 w-3"}),"5% so với kỳ trước"]})})]})]})]}),e.jsxs(le,{defaultValue:"revenue",className:"space-y-4",children:[e.jsxs(re,{children:[e.jsx(k,{value:"revenue",children:"Doanh thu"}),e.jsx(k,{value:"services",children:"Dịch vụ"}),e.jsx(k,{value:"staff",children:"Nhân viên"})]}),e.jsx(A,{value:"revenue",className:"space-y-4",children:e.jsxs(c,{children:[e.jsxs(h,{children:[e.jsx(d,{children:"Biểu đồ doanh thu"}),e.jsx(b,{children:"Doanh thu và số lượng lịch hẹn theo thời gian"})]}),e.jsx(x,{className:"h-80",children:N?e.jsx("div",{className:"flex h-full items-center justify-center",children:e.jsx(o,{className:"h-8 w-8 animate-spin text-primary"})}):!l||l.length===0?e.jsx("div",{className:"flex h-full items-center justify-center text-gray-500",children:"Không có dữ liệu doanh thu trong khoảng thời gian đã chọn"}):e.jsx(q,{width:"100%",height:"100%",children:e.jsxs(de,{data:l,margin:{top:20,right:30,left:20,bottom:5},children:[e.jsx(xe,{strokeDasharray:"3 3"}),e.jsx(oe,{dataKey:"date"}),e.jsx(z,{yAxisId:"left",orientation:"left",stroke:"#6A2C70"}),e.jsx(z,{yAxisId:"right",orientation:"right",stroke:"#177E89"}),e.jsx(Y,{}),e.jsx(me,{}),e.jsx(X,{yAxisId:"left",dataKey:"revenue",name:"Doanh thu (VNĐ)",fill:"#6A2C70"}),e.jsx(X,{yAxisId:"right",dataKey:"appointments",name:"Số lịch hẹn",fill:"#177E89"})]})})})]})}),e.jsx(A,{value:"services",className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsxs(c,{children:[e.jsxs(h,{children:[e.jsx(d,{children:"Phân bố dịch vụ"}),e.jsx(b,{children:"Tỷ lệ sử dụng các dịch vụ theo doanh thu"})]}),e.jsx(x,{className:"h-80",children:L?e.jsx("div",{className:"flex h-full items-center justify-center",children:e.jsx(o,{className:"h-8 w-8 animate-spin text-primary"})}):!r||r.length===0?e.jsx("div",{className:"flex h-full items-center justify-center text-gray-500",children:"Không có dữ liệu dịch vụ trong khoảng thời gian đã chọn"}):e.jsx(q,{width:"100%",height:"100%",children:e.jsxs(je,{children:[e.jsx(ue,{data:r,cx:"50%",cy:"50%",labelLine:!1,label:({name:s,percent:a})=>`${s}: ${(a*100).toFixed(0)}%`,outerRadius:80,fill:"#8884d8",dataKey:"revenue",nameKey:"name",children:r.map((s,a)=>e.jsx(ge,{fill:P[a%P.length]},`cell-${a}`))}),e.jsx(Y,{formatter:s=>`${s.toLocaleString("vi-VN")}₫`})]})})})]}),e.jsxs(c,{children:[e.jsxs(h,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsxs("div",{children:[e.jsx(d,{children:"Hiệu suất dịch vụ"}),e.jsx(b,{children:"Phân tích doanh thu theo dịch vụ"})]}),e.jsxs(M,{defaultValue:"revenue",children:[e.jsx(B,{className:"w-[130px]",children:e.jsx(O,{placeholder:"Sắp xếp theo"})}),e.jsxs($,{children:[e.jsx(g,{value:"revenue",children:"Doanh thu"}),e.jsx(g,{value:"count",children:"Số lượng"}),e.jsx(g,{value:"percentage",children:"Tỷ lệ"})]})]})]}),e.jsx(x,{children:L?e.jsx("div",{className:"flex h-60 items-center justify-center",children:e.jsx(o,{className:"h-8 w-8 animate-spin text-primary"})}):!r||r.length===0?e.jsx("div",{className:"flex h-60 items-center justify-center text-gray-500",children:"Không có dữ liệu dịch vụ trong khoảng thời gian đã chọn"}):e.jsx("div",{className:"rounded-md border",children:e.jsxs(E,{children:[e.jsx(H,{children:e.jsxs(w,{children:[e.jsx(t,{children:"Dịch vụ"}),e.jsx(t,{className:"text-right",children:"Số lượng"}),e.jsx(t,{className:"text-right",children:"Doanh thu"}),e.jsx(t,{className:"text-right",children:"Tỷ lệ"})]})}),e.jsx(V,{children:r.map(s=>e.jsxs(w,{children:[e.jsx(n,{children:s.name}),e.jsx(n,{className:"text-right",children:s.count}),e.jsxs(n,{className:"text-right",children:[(s.revenue/1e6).toFixed(2),"M ₫"]}),e.jsxs(n,{className:"text-right",children:[s.percentage.toFixed(1),"%"]})]},s.id))})]})})})]})]})}),e.jsx(A,{value:"staff",className:"space-y-4",children:e.jsxs(c,{children:[e.jsxs(h,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsxs("div",{children:[e.jsx(d,{children:"Hiệu suất nhân viên"}),e.jsx(b,{children:"Phân tích doanh thu và đánh giá theo nhân viên"})]}),e.jsxs(M,{defaultValue:"revenue",children:[e.jsx(B,{className:"w-[130px]",children:e.jsx(O,{placeholder:"Sắp xếp theo"})}),e.jsxs($,{children:[e.jsx(g,{value:"revenue",children:"Doanh thu"}),e.jsx(g,{value:"appointments",children:"Lịch hẹn"}),e.jsx(g,{value:"rating",children:"Đánh giá"})]})]})]}),e.jsx(x,{children:U?e.jsx("div",{className:"flex h-60 items-center justify-center",children:e.jsx(o,{className:"h-8 w-8 animate-spin text-primary"})}):!C||C.length===0?e.jsx("div",{className:"flex h-60 items-center justify-center text-gray-500",children:"Không có dữ liệu nhân viên trong khoảng thời gian đã chọn"}):e.jsx("div",{className:"rounded-md border",children:e.jsxs(E,{children:[e.jsx(H,{children:e.jsxs(w,{children:[e.jsx(t,{children:"Nhân viên"}),e.jsx(t,{className:"text-right",children:"Số lịch hẹn"}),e.jsx(t,{className:"text-right",children:"Doanh thu"}),e.jsx(t,{className:"text-right",children:"Đánh giá TB"})]})}),e.jsx(V,{children:C.map(s=>e.jsxs(w,{children:[e.jsx(n,{className:"font-medium",children:s.name}),e.jsx(n,{className:"text-right",children:s.appointments}),e.jsxs(n,{className:"text-right",children:[(s.revenue/1e6).toFixed(2),"M ₫"]}),e.jsx(n,{className:"text-right",children:e.jsxs("div",{className:"flex items-center justify-end",children:[e.jsx("span",{children:s.rating.toFixed(1)}),e.jsx("svg",{className:"ml-1 h-4 w-4 text-yellow-500",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M10 15.585l-5.793 3.058 1.108-6.461-4.685-4.568 6.5-.945L10 1.058 12.87 6.67l6.5.945-4.685 4.568 1.108 6.461L10 15.585z",clipRule:"evenodd"})})]})})]},s.id))})]})})}),e.jsx(ie,{className:"border-t pt-4",children:e.jsx("p",{className:"text-xs text-gray-500",children:"Đánh giá trung bình được tính dựa trên phản hồi của khách hàng."})})]})})]})]})}export{He as default};
