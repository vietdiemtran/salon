import{n as te,r,o as Ne,j as e,X as be,z as c,A as F}from"./index-Co3jKZaL.js";import{B as n}from"./button-BNCUvJzd.js";import{C as x,b as A,c as I,d as D,a as p,e as V}from"./card-5fN4BC23.js";import{D as G,a as ke,b as O,c as $,d as J,e as X}from"./dialog-DsEfTekn.js";import{u as we,F as Ce,a as g,b as j,c as y,d as f,e as L,f as W,s as Te,z as Se}from"./zod-DR_j3zP9.js";import{I as Y}from"./input-DAU5vPOq.js";import{P as Pe}from"./progress-Bp-sVc3x.js";import{S as Fe}from"./switch-CzByGCby.js";import{T as Ae,a as Ie,b as Z,c as ee}from"./tabs-DcYlk8AQ.js";import{T as De}from"./textarea-DI5-A45c.js";import{a as Le,t as He,b as qe,c as H,s as Ke,d as Ue}from"./index-P0gQCl1x.js";import{u as q}from"./useQuery-D61Jsyd7.js";import{u as v}from"./useMutation-BSFioODP.js";import{P as se}from"./plus-CAZAkEn4.js";import{L as K}from"./loader-circle-DuW_hbzs.js";import{S as U}from"./scissors-DX-8gafM.js";import{P as Me}from"./pencil-D5-fFQMG.js";import{T as Re}from"./trash-2-Cbbl3EUH.js";import{C as Ee}from"./camera-BMfv41_7.js";import{I as ze}from"./info-DK0A6Nfs.js";import{C as M}from"./index-m_3Aq4-g.js";import"./Combination-Bb8ckWgm.js";import"./label-BQaUV1Av.js";import"./index-BV-DTqk3.js";import"./index-pdkFIaqS.js";/**
 * @license lucide-react v0.488.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qe=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]],_e=te("image",Qe);/**
 * @license lucide-react v0.488.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Be=[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]],Ve=te("upload",Be),Ge=Le("hairstyles",{id:Ke("id").primaryKey(),name:H("name").notNull(),imageUrl:H("image_url"),description:H("description"),isTrending:qe("is_trending").default(!1),createdAt:He("created_at").defaultNow()}),Oe=Ue(Ge).omit({id:!0,createdAt:!0}),$e=Oe.extend({imageUrl:Se.string().min(1,"Vui lòng nhập URL hình ảnh")});function Ns(){var B;const[N,ie]=r.useState(!0),[d,b]=r.useState(null),[ne,l]=r.useState(!1),[k,R]=r.useState(null),[w,E]=r.useState(null),[ae,C]=r.useState(!1),[z,m]=r.useState(0),[re,ce]=r.useState("upload"),[le,he]=r.useState(null),u=r.useRef(null),{toast:i}=Ne(),{data:de=[],isLoading:oe}=q({queryKey:["/api/ai-style/history"]}),{data:Q=[],isLoading:me}=q({queryKey:["/api/hairstyles"]}),{data:Je=[]}=q({queryKey:["/api/hairstyles/trending"]}),a=we({resolver:Te($e),defaultValues:{name:"",imageUrl:"",description:"",isTrending:!1}}),T=v({mutationFn:async s=>await(await F("POST","/api/hairstyles",s)).json(),onSuccess:()=>{i({title:"Thêm kiểu tóc thành công",description:"Kiểu tóc mới đã được thêm vào danh sách"}),c.invalidateQueries({queryKey:["/api/hairstyles"]}),c.invalidateQueries({queryKey:["/api/hairstyles/trending"]}),l(!1),a.reset()},onError:s=>{i({title:"Lỗi khi thêm kiểu tóc",description:s.message||"Đã xảy ra lỗi, vui lòng thử lại",variant:"destructive"})}}),S=v({mutationFn:async s=>{const{id:t,...o}=s;return await(await F("PATCH",`/api/hairstyles/${t}`,o)).json()},onSuccess:()=>{i({title:"Cập nhật kiểu tóc thành công",description:"Thông tin kiểu tóc đã được cập nhật"}),c.invalidateQueries({queryKey:["/api/hairstyles"]}),c.invalidateQueries({queryKey:["/api/hairstyles/trending"]}),l(!1),b(null),a.reset()},onError:s=>{i({title:"Lỗi khi cập nhật kiểu tóc",description:s.message||"Đã xảy ra lỗi, vui lòng thử lại",variant:"destructive"})}}),ue=v({mutationFn:async s=>{await F("DELETE",`/api/hairstyles/${s}`)},onSuccess:()=>{i({title:"Xóa kiểu tóc thành công",description:"Kiểu tóc đã được xóa khỏi danh sách"}),c.invalidateQueries({queryKey:["/api/hairstyles"]}),c.invalidateQueries({queryKey:["/api/hairstyles/trending"]})},onError:s=>{i({title:"Lỗi khi xóa kiểu tóc",description:s.message||"Đã xảy ra lỗi, vui lòng thử lại",variant:"destructive"})}}),_=()=>{a.reset({name:"",imageUrl:"",description:"",isTrending:!1}),b(null),l(!0)},xe=s=>{a.reset({name:s.name,imageUrl:s.imageUrl||"",description:s.description||"",isTrending:s.isTrending===!0}),b(s.id),l(!0)},pe=s=>{d?S.mutate({...s,id:d}):T.mutate(s)},ge=v({mutationFn:async s=>{const t=await fetch("/api/ai-style/analyze",{method:"POST",body:s,credentials:"include"});if(!t.ok)throw new Error("Không thể phân tích hình ảnh");return t.json()},onMutate:()=>{C(!0),m(0);const s=setInterval(()=>{m(t=>t>=95?(clearInterval(s),95):t+5)},300);return()=>clearInterval(s)},onSuccess:s=>{m(100),C(!1),c.invalidateQueries({queryKey:["/api/ai-style/history"]}),i({title:"Phân tích thành công",description:"Chúng tôi đã tìm thấy một số kiểu tóc phù hợp cho bạn"})},onError:s=>{C(!1),m(0),i({title:"Lỗi phân tích",description:s.message,variant:"destructive"})}}),je=s=>{var P;const t=(P=s.target.files)==null?void 0:P[0];if(!t)return;if(!t.type.startsWith("image/")){i({title:"Lỗi định dạng",description:"Vui lòng chọn một tệp hình ảnh (JPG, PNG, etc.)",variant:"destructive"});return}if(t.size>5*1024*1024){i({title:"Tệp quá lớn",description:"Vui lòng chọn tệp nhỏ hơn 5MB",variant:"destructive"});return}R(t);const o=new FileReader;o.onloadend=()=>{E(o.result)},o.readAsDataURL(t)},ye=()=>{i({title:"Chức năng camera",description:"Tính năng chụp ảnh từ camera sẽ được cập nhật trong phiên bản tới.",variant:"default"})},fe=s=>{if(s.preventDefault(),!k){i({title:"Chưa có hình ảnh",description:"Vui lòng tải lên hình ảnh khuôn mặt của bạn",variant:"destructive"});return}const t=new FormData;t.append("image",k),ge.mutate(t)},ve=()=>{R(null),E(null),u.current&&(u.current.value="")},h=de[0];return e.jsxs("div",{children:[e.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"font-heading text-2xl font-bold text-neutral-900",children:"Gợi ý kiểu tóc AI"}),e.jsx("p",{className:"text-neutral-600",children:"Tìm kiểu tóc phù hợp với khuôn mặt và phong cách của bạn"})]}),e.jsx(n,{variant:"outline",onClick:()=>ie(!N),children:N?"Chế độ khách hàng":"Chế độ quản lý"})]}),N?e.jsx("div",{className:"mb-8",children:e.jsxs(x,{children:[e.jsxs(A,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsxs("div",{children:[e.jsx(I,{children:"Quản lý kiểu tóc"}),e.jsx(D,{children:"Thêm và quản lý các kiểu tóc có sẵn trong hệ thống"})]}),e.jsxs(n,{onClick:_,children:[e.jsx(se,{className:"mr-2 h-4 w-4"}),"Thêm kiểu tóc mới"]})]}),e.jsx(p,{children:me?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx(K,{className:"h-8 w-8 animate-spin text-primary"})}):Q.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-8 text-center",children:[e.jsx(U,{className:"mb-4 h-12 w-12 text-muted-foreground"}),e.jsx("h3",{className:"text-lg font-medium",children:"Chưa có kiểu tóc nào"}),e.jsx("p",{className:"mb-4 mt-2 text-sm text-muted-foreground",children:"Bắt đầu thêm kiểu tóc vào hệ thống để sử dụng cho phân tích AI"}),e.jsxs(n,{onClick:_,children:[e.jsx(se,{className:"mr-2 h-4 w-4"}),"Thêm kiểu tóc"]})]}):e.jsx("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:Q.map(s=>e.jsxs(x,{className:"overflow-hidden",children:[e.jsxs("div",{className:"relative h-48",children:[s.imageUrl?e.jsx("img",{src:s.imageUrl,alt:s.name,className:"h-full w-full object-cover"}):e.jsx("div",{className:"flex h-full w-full items-center justify-center bg-muted",children:e.jsx(_e,{className:"h-12 w-12 text-muted-foreground"})}),s.isTrending&&e.jsx("div",{className:"absolute left-2 top-2 rounded-md bg-primary px-2 py-1 text-xs text-white",children:"Thịnh hành"})]}),e.jsx(p,{className:"pt-4",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"truncate font-semibold",children:s.name}),s.description&&e.jsx("p",{className:"mt-1 line-clamp-2 text-sm text-muted-foreground",children:s.description})]}),e.jsxs("div",{className:"flex space-x-1",children:[e.jsx(n,{size:"icon",variant:"ghost",onClick:()=>xe(s),children:e.jsx(Me,{className:"h-4 w-4"})}),e.jsx(n,{size:"icon",variant:"ghost",className:"text-destructive hover:text-destructive",onClick:()=>{confirm(`Bạn có chắc muốn xóa kiểu tóc "${s.name}"?`)&&ue.mutate(s.id)},children:e.jsx(Re,{className:"h-4 w-4"})})]})]})})]},s.id))})})]})}):null,e.jsxs("div",{className:"grid grid-cols-1 gap-6 lg:grid-cols-3",children:[e.jsx("div",{className:"lg:col-span-1",children:e.jsxs(x,{children:[e.jsxs(A,{children:[e.jsx(I,{children:"Phân tích khuôn mặt"}),e.jsx(D,{children:"Tải lên ảnh khuôn mặt của bạn để AI phân tích và gợi ý kiểu tóc phù hợp"})]}),e.jsx(p,{children:e.jsxs(Ae,{value:re,onValueChange:ce,children:[e.jsxs(Ie,{className:"grid w-full grid-cols-2",children:[e.jsx(Z,{value:"upload",children:"Tải lên"}),e.jsx(Z,{value:"camera",children:"Camera"})]}),e.jsx(ee,{value:"upload",className:"py-4",children:e.jsxs("form",{onSubmit:fe,children:[e.jsxs("div",{className:`flex h-64 cursor-pointer flex-col items-center justify-center rounded-lg border-2 border-dashed p-4 hover:bg-gray-50 ${w?"border-primary":"border-gray-300"}`,onClick:()=>{var s;return(s=u.current)==null?void 0:s.click()},children:[w?e.jsxs("div",{className:"relative h-full w-full",children:[e.jsx("img",{src:w,alt:"Preview",className:"h-full w-full object-contain"}),e.jsx("button",{type:"button",className:"absolute right-2 top-2 rounded-full bg-white p-1 shadow-sm",onClick:s=>{s.stopPropagation(),ve()},children:e.jsx(be,{className:"h-4 w-4"})})]}):e.jsxs(e.Fragment,{children:[e.jsx(Ve,{className:"mb-2 h-10 w-10 text-gray-400"}),e.jsx("p",{className:"mb-1 text-sm text-gray-500",children:"Kéo thả hoặc nhấp để tải ảnh lên"}),e.jsx("p",{className:"text-xs text-gray-400",children:"PNG, JPG (tối đa 5MB)"})]}),e.jsx("input",{type:"file",accept:"image/*",ref:u,onChange:je,className:"hidden"})]}),ae?e.jsxs("div",{className:"mt-4 space-y-2",children:[e.jsx(Pe,{value:z}),e.jsxs("p",{className:"text-center text-sm text-gray-500",children:["Đang phân tích hình ảnh... ",z,"%"]})]}):e.jsx(n,{type:"submit",className:"mt-4 w-full",disabled:!k,children:"Phân tích khuôn mặt"})]})}),e.jsx(ee,{value:"camera",className:"py-4",children:e.jsxs("div",{className:"flex h-64 flex-col items-center justify-center rounded-lg border-2 border-dashed border-gray-300 p-4",children:[e.jsx(Ee,{className:"mb-2 h-10 w-10 text-gray-400"}),e.jsx("p",{className:"mb-1 text-sm text-gray-500",children:"Sử dụng camera để chụp ảnh"}),e.jsx(n,{onClick:ye,className:"mt-2",children:"Mở camera"})]})})]})}),e.jsx(V,{className:"flex-col items-start pt-0",children:e.jsxs("div",{className:"flex items-start space-x-2 text-sm text-gray-500",children:[e.jsx(ze,{className:"mt-0.5 h-4 w-4 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{children:"Để có kết quả tốt nhất, vui lòng tải lên ảnh:"}),e.jsxs("ul",{className:"mt-1 list-disc space-y-1 pl-5 text-xs",children:[e.jsx("li",{children:"Chụp thẳng mặt, không bị che khuất"}),e.jsx("li",{children:"Ánh sáng tốt, không quá tối hoặc quá sáng"}),e.jsx("li",{children:"Nền đơn giản, không có nhiều chi tiết phức tạp"})]})]})]})})]})}),e.jsx("div",{className:"lg:col-span-2",children:e.jsxs(x,{className:"h-full",children:[e.jsxs(A,{children:[e.jsx(I,{children:"Gợi ý kiểu tóc"}),e.jsx(D,{children:"Dựa trên phân tích khuôn mặt và xu hướng hiện tại"})]}),e.jsx(p,{children:oe?e.jsx("div",{className:"flex h-80 items-center justify-center",children:e.jsx(K,{className:"h-8 w-8 animate-spin text-primary"})}):h?e.jsxs("div",{children:[e.jsxs("div",{className:"bg-primary-light mb-4 rounded-lg bg-opacity-5 p-4",children:[e.jsx("h3",{className:"mb-2 font-semibold",children:"Phân tích khuôn mặt"}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsx("div",{children:e.jsx("img",{src:h.faceImageUrl||"",alt:"Face Analysis",className:"h-auto w-full rounded-lg"})}),e.jsxs("div",{children:[e.jsx("p",{className:"mb-3 text-sm text-gray-500",children:"Dựa trên hình dáng khuôn mặt và đặc điểm của bạn, AI đã phân tích và gợi ý những kiểu tóc có thể phù hợp nhất."}),e.jsx("p",{className:"text-sm font-medium",children:"Đặc điểm nhận diện:"}),e.jsxs("ul",{className:"mt-1 space-y-1 text-sm",children:[e.jsxs("li",{className:"flex items-center",children:[e.jsx(M,{className:"mr-2 h-4 w-4 text-green-500"}),"Khuôn mặt: Oval"]}),e.jsxs("li",{className:"flex items-center",children:[e.jsx(M,{className:"mr-2 h-4 w-4 text-green-500"}),"Cấu trúc: Cân đối"]}),e.jsxs("li",{className:"flex items-center",children:[e.jsx(M,{className:"mr-2 h-4 w-4 text-green-500"}),"Phong cách: Hiện đại"]})]})]})]})]}),e.jsx("h3",{className:"mb-3 font-semibold",children:"Kiểu tóc được gợi ý"}),e.jsx("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2 md:grid-cols-3",children:(B=h.recommendedStyles)==null?void 0:B.map((s,t)=>e.jsxs("div",{className:`cursor-pointer overflow-hidden rounded-lg border transition-all ${le===s?"ring-2 ring-primary":"hover:shadow-md"}`,onClick:()=>he(s),children:[e.jsx("div",{className:"relative h-40 bg-gray-200",children:e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx(U,{className:"h-8 w-8 text-gray-400"})})}),e.jsxs("div",{className:"p-3",children:[e.jsx("h4",{className:"text-sm font-medium",children:s}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Phù hợp với khuôn mặt của bạn"})]})]},t))})]}):e.jsxs("div",{className:"flex h-80 flex-col items-center justify-center text-center",children:[e.jsx("div",{className:"bg-primary-light mb-4 rounded-full bg-opacity-10 p-6",children:e.jsx(U,{className:"h-12 w-12 text-primary"})}),e.jsx("h3",{className:"mb-2 text-xl font-semibold",children:"Chưa có gợi ý nào"}),e.jsx("p",{className:"mb-4 max-w-md text-neutral-600",children:"Hãy tải lên ảnh khuôn mặt của bạn để AI phân tích và gợi ý các kiểu tóc phù hợp."})]})}),h&&e.jsxs(V,{className:"flex justify-between border-t pt-4",children:[e.jsxs("p",{className:"text-xs text-gray-500",children:["Kết quả được tạo ra vào:"," ",h.createdAt?new Date(h.createdAt).toLocaleString("vi-VN"):"N/A"]}),e.jsxs(G,{children:[e.jsx(ke,{asChild:!0,children:e.jsx(n,{variant:"outline",size:"sm",children:"Đặt lịch tư vấn"})}),e.jsxs(O,{className:"sm:max-w-md",children:[e.jsxs($,{children:[e.jsx(J,{children:"Đặt lịch tư vấn với chuyên gia"}),e.jsx(X,{children:"Đặt lịch để được tư vấn trực tiếp và thực hiện kiểu tóc được gợi ý"})]}),e.jsxs("div",{className:"rounded-md bg-gray-50 p-4 text-center",children:[e.jsx("p",{className:"text-gray-600",children:"Vui lòng sử dụng chức năng đặt lịch hẹn để chọn thời gian và dịch vụ phù hợp."}),e.jsx(n,{className:"mt-4",asChild:!0,children:e.jsx("a",{href:"/appointments",children:"Đến trang đặt lịch"})})]})]})]})]})]})})]}),e.jsx(G,{open:ne,onOpenChange:l,children:e.jsxs(O,{className:"sm:max-w-md",children:[e.jsxs($,{children:[e.jsx(J,{children:d?"Chỉnh sửa kiểu tóc":"Thêm kiểu tóc mới"}),e.jsx(X,{children:d?"Cập nhật thông tin kiểu tóc đã có trong hệ thống":"Thêm kiểu tóc mới vào hệ thống để sử dụng cho gợi ý AI"})]}),e.jsx(Ce,{...a,children:e.jsxs("form",{onSubmit:a.handleSubmit(pe),className:"space-y-4",children:[e.jsx(g,{control:a.control,name:"name",render:({field:s})=>e.jsxs(j,{children:[e.jsx(y,{children:"Tên kiểu tóc"}),e.jsx(f,{children:e.jsx(Y,{placeholder:"Nhập tên kiểu tóc",...s})}),e.jsx(L,{})]})}),e.jsx(g,{control:a.control,name:"imageUrl",render:({field:s})=>e.jsxs(j,{children:[e.jsx(y,{children:"URL hình ảnh"}),e.jsx(f,{children:e.jsx(Y,{placeholder:"https://example.com/image.jpg",...s})}),e.jsx(W,{children:"Nhập URL hình ảnh minh họa cho kiểu tóc này"}),e.jsx(L,{})]})}),e.jsx(g,{control:a.control,name:"description",render:({field:s})=>e.jsxs(j,{children:[e.jsx(y,{children:"Mô tả"}),e.jsx(f,{children:e.jsx(De,{placeholder:"Mô tả chi tiết về kiểu tóc này",className:"min-h-[100px]",value:s.value||"",onChange:s.onChange,onBlur:s.onBlur,ref:s.ref,name:s.name,disabled:s.disabled})}),e.jsx(L,{})]})}),e.jsx(g,{control:a.control,name:"isTrending",render:({field:s})=>e.jsxs(j,{className:"flex flex-row items-center justify-between rounded-lg border p-3",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(y,{children:"Kiểu tóc thịnh hành"}),e.jsx(W,{children:"Đánh dấu kiểu tóc này là thịnh hành để hiển thị nổi bật"})]}),e.jsx(f,{children:e.jsx(Fe,{checked:s.value===!0,onCheckedChange:s.onChange})})]})}),e.jsxs("div",{className:"flex justify-end space-x-2 pt-2",children:[e.jsx(n,{type:"button",variant:"outline",onClick:()=>l(!1),children:"Hủy"}),e.jsxs(n,{type:"submit",disabled:T.isPending||S.isPending,children:[(T.isPending||S.isPending)&&e.jsx(K,{className:"mr-2 h-4 w-4 animate-spin"}),d?"Cập nhật":"Thêm mới"]})]})]})})]})})]})}export{Ns as default};
